// Code generated by Fern. DO NOT EDIT.

package entitlements_test

import (
	context "context"
	fmt "fmt"
	schematicgo "github.com/SchematicHQ/schematic-go"
	client "github.com/SchematicHQ/schematic-go/client"
	option "github.com/SchematicHQ/schematic-go/option"
	require "github.com/stretchr/testify/require"
	gowiremock "github.com/wiremock/go-wiremock"
	wiremocktestcontainersgo "github.com/wiremock/wiremock-testcontainers-go"
	http "net/http"
	os "os"
	testing "testing"
)

// TestMain sets up shared test fixtures for all tests in this package// Global test fixtures
var (
	WireMockContainer *wiremocktestcontainersgo.WireMockContainer
	WireMockBaseURL   string
	WireMockClient    *gowiremock.Client
)

// TestMain sets up shared test fixtures for all tests in this package
func TestMain(m *testing.M) {
	// Setup shared WireMock container
	ctx := context.Background()
	container, err := wiremocktestcontainersgo.RunContainerAndStopOnCleanup(
		ctx,
		&testing.T{},
		wiremocktestcontainersgo.WithImage("docker.io/wiremock/wiremock:3.9.1"),
	)
	if err != nil {
		fmt.Printf("Failed to start WireMock container: %v\n", err)
		os.Exit(1)
	}

	// Store global references
	WireMockContainer = container

	// Try to get the base URL using the standard method first
	baseURL, err := container.Endpoint(ctx, "")
	if err == nil {
		// Standard method worked (running outside DinD)
		// This uses the mapped port (e.g., localhost:59553)
		WireMockBaseURL = "http://" + baseURL
		WireMockClient = container.Client
	} else {
		// Standard method failed, use internal IP fallback (DinD environment)
		fmt.Printf("Standard endpoint resolution failed, using internal IP fallback: %v\n", err)

		inspect, err := container.Inspect(ctx)
		if err != nil {
			fmt.Printf("Failed to inspect WireMock container: %v\n", err)
			os.Exit(1)
		}

		// Find the IP address from the container's networks
		var containerIP string
		for _, network := range inspect.NetworkSettings.Networks {
			if network.IPAddress != "" {
				containerIP = network.IPAddress
				break
			}
		}

		if containerIP == "" {
			fmt.Printf("Failed to get WireMock container IP address\n")
			os.Exit(1)
		}

		// In DinD, use the internal port directly (8080 for WireMock HTTP)
		// Don't use the mapped port since it doesn't exist in this environment
		WireMockBaseURL = fmt.Sprintf("http://%s:8080", containerIP)

		// The container.Client was created with a bad URL, so we need a new one
		WireMockClient = gowiremock.NewClient(WireMockBaseURL)
	}

	fmt.Printf("WireMock available at: %s\n", WireMockBaseURL)

	// Run all tests
	code := m.Run()

	// Cleanup
	if WireMockContainer != nil {
		WireMockContainer.Terminate(ctx)
	}

	// Exit with the same code as the tests
	os.Exit(code)
}

func TestEntitlementsListCompanyOverridesWithWireMock(
	t *testing.T,
) {
	// wiremock client and server initialized in shared main_test.go
	defer WireMockClient.Reset()
	stub := gowiremock.Get(gowiremock.URLPathTemplate("/company-overrides")).WillReturnResponse(
		gowiremock.NewResponse().WithJSONBody(
			map[string]interface{}{"data": []interface{}{map[string]interface{}{"company": map[string]interface{}{"add_ons": []interface{}{map[string]interface{}{"id": "id", "name": "name"}}, "billing_subscriptions": []interface{}{map[string]interface{}{"cancel_at_period_end": true, "created_at": "2024-01-15T09:30:00Z", "currency": "currency", "customer_external_id": "customer_external_id", "discounts": []interface{}{map[string]interface{}{"coupon_id": "coupon_id", "coupon_name": "coupon_name", "discount_external_id": "discount_external_id", "duration": "duration", "is_active": true, "started_at": "2024-01-15T09:30:00Z", "subscription_external_id": "subscription_external_id"}}, "id": "id", "interval": "interval", "period_end": 1, "period_start": 1, "products": []interface{}{map[string]interface{}{"billing_scheme": "billing_scheme", "created_at": "2024-01-15T09:30:00Z", "currency": "currency", "environment_id": "environment_id", "external_id": "external_id", "id": "id", "interval": "interval", "name": "name", "package_size": 1, "price": 1, "price_external_id": "price_external_id", "price_id": "price_id", "price_tier": []interface{}{map[string]interface{}{}}, "quantity": 1.1, "subscription_id": "subscription_id", "updated_at": "2024-01-15T09:30:00Z", "usage_type": "usage_type"}}, "status": "status", "subscription_external_id": "subscription_external_id", "total_price": 1}}, "created_at": "2024-01-15T09:30:00Z", "entity_traits": []interface{}{map[string]interface{}{"created_at": "2024-01-15T09:30:00Z", "definition_id": "definition_id", "environment_id": "environment_id", "id": "id", "updated_at": "2024-01-15T09:30:00Z", "value": "value"}}, "environment_id": "environment_id", "id": "id", "keys": []interface{}{map[string]interface{}{"created_at": "2024-01-15T09:30:00Z", "definition_id": "definition_id", "entity_id": "entity_id", "entity_type": "entity_type", "environment_id": "environment_id", "id": "id", "key": "key", "updated_at": "2024-01-15T09:30:00Z", "value": "value"}}, "metrics": []interface{}{map[string]interface{}{"account_id": "account_id", "captured_at_max": "2024-01-15T09:30:00Z", "captured_at_min": "2024-01-15T09:30:00Z", "company_id": "company_id", "created_at": "2024-01-15T09:30:00Z", "environment_id": "environment_id", "event_subtype": "event_subtype", "month_reset": "month_reset", "period": "period", "value": 1}}, "name": "name", "payment_methods": []interface{}{map[string]interface{}{"created_at": "2024-01-15T09:30:00Z", "customer_external_id": "customer_external_id", "environment_id": "environment_id", "external_id": "external_id", "id": "id", "payment_method_type": "payment_method_type", "updated_at": "2024-01-15T09:30:00Z"}}, "plans": []interface{}{map[string]interface{}{"id": "id", "name": "name"}}, "rules": []interface{}{map[string]interface{}{"account_id": "account_id", "condition_groups": []interface{}{map[string]interface{}{"conditions": []interface{}{map[string]interface{}{"account_id": "account_id", "condition_type": "base_plan", "environment_id": "environment_id", "id": "id", "operator": "eq", "resource_ids": []interface{}{"resource_ids"}, "trait_value": "trait_value"}}}}, "conditions": []interface{}{map[string]interface{}{"account_id": "account_id", "condition_type": "base_plan", "environment_id": "environment_id", "id": "id", "operator": "eq", "resource_ids": []interface{}{"resource_ids"}, "trait_value": "trait_value"}}, "environment_id": "environment_id", "id": "id", "name": "name", "priority": 1, "rule_type": "default", "value": true}}, "updated_at": "2024-01-15T09:30:00Z", "user_count": 1}, "company_id": "company_id", "consumption_rate": 1.1, "created_at": "2024-01-15T09:30:00Z", "environment_id": "environment_id", "expiration_date": "2024-01-15T09:30:00Z", "feature": map[string]interface{}{"created_at": "2024-01-15T09:30:00Z", "description": "description", "feature_type": "feature_type", "icon": "icon", "id": "id", "name": "name", "updated_at": "2024-01-15T09:30:00Z"}, "feature_id": "feature_id", "id": "id", "metric_period": "metric_period", "metric_period_month_reset": "metric_period_month_reset", "notes": []interface{}{map[string]interface{}{"created_at": "2024-01-15T09:30:00Z", "external_user_id": "external_user_id", "external_user_name": "external_user_name", "id": "id", "note": "note", "updated_at": "2024-01-15T09:30:00Z"}}, "rule_id": "rule_id", "rule_id_usage_exceeded": "rule_id_usage_exceeded", "updated_at": "2024-01-15T09:30:00Z", "value_bool": true, "value_numeric": 1, "value_trait": map[string]interface{}{"created_at": "2024-01-15T09:30:00Z", "display_name": "display_name", "entity_type": "entity_type", "hierarchy": []interface{}{"hierarchy"}, "id": "id", "trait_type": "trait_type", "updated_at": "2024-01-15T09:30:00Z"}, "value_trait_id": "value_trait_id", "value_type": "value_type"}}, "params": map[string]interface{}{"company_id": "company_id", "company_ids": []interface{}{"company_ids"}, "feature_id": "feature_id", "feature_ids": []interface{}{"feature_ids"}, "ids": []interface{}{"ids"}, "limit": 1, "offset": 1, "q": "q", "without_expired": true}},
		).WithStatus(http.StatusOK),
	)
	err := WireMockClient.StubFor(stub)
	require.NoError(t, err, "Failed to create WireMock stub")

	client := client.NewSchematicClient(
		option.WithBaseURL(
			WireMockBaseURL,
		),
	)
	request := &schematichq.ListCompanyOverridesRequest{
		CompanyID: schematichq.String(
			"company_id",
		),
		FeatureID: schematichq.String(
			"feature_id",
		),
		WithoutExpired: schematichq.Bool(
			true,
		),
		Q: schematichq.String(
			"q",
		),
		Limit: schematichq.Int(
			1,
		),
		Offset: schematichq.Int(
			1,
		),
	}
	_, invocationErr := client.Entitlements.ListCompanyOverrides(
		context.TODO(),
		request,
	)

	require.NoError(t, invocationErr, "Client method call should succeed")
	ok, countErr := WireMockClient.Verify(stub.Request(), 1)
	require.NoError(t, countErr, "Failed to verify WireMock request was matched")
	require.True(t, ok, "WireMock request was not matched")
}

func TestEntitlementsCreateCompanyOverrideWithWireMock(
	t *testing.T,
) {
	// wiremock client and server initialized in shared main_test.go
	defer WireMockClient.Reset()
	stub := gowiremock.Post(gowiremock.URLPathTemplate("/company-overrides")).WithBodyPattern(gowiremock.MatchesJsonSchema(`{
                    "$schema": "https://json-schema.org/draft/2020-12/schema",
                    "type": "object",
                    "required": ["company_id", "feature_id", "value_type"],
                    "properties": {
                        "company_id": {"type": "string"}, "feature_id": {"type": "string"}, "value_type": {"type": "string"}
                    },
                    "additionalProperties": true
                }`, "V202012")).WillReturnResponse(
		gowiremock.NewResponse().WithJSONBody(
			map[string]interface{}{"data": map[string]interface{}{"company": map[string]interface{}{"add_ons": []interface{}{map[string]interface{}{"id": "id", "name": "name"}}, "billing_credit_balances": map[string]interface{}{"key": 1.1}, "billing_subscription": map[string]interface{}{"cancel_at_period_end": true, "created_at": "2024-01-15T09:30:00Z", "currency": "currency", "customer_external_id": "customer_external_id", "discounts": []interface{}{map[string]interface{}{"coupon_id": "coupon_id", "coupon_name": "coupon_name", "discount_external_id": "discount_external_id", "duration": "duration", "is_active": true, "started_at": "2024-01-15T09:30:00Z", "subscription_external_id": "subscription_external_id"}}, "id": "id", "interval": "interval", "period_end": 1, "period_start": 1, "products": []interface{}{map[string]interface{}{"billing_scheme": "billing_scheme", "created_at": "2024-01-15T09:30:00Z", "currency": "currency", "environment_id": "environment_id", "external_id": "external_id", "id": "id", "interval": "interval", "name": "name", "package_size": 1, "price": 1, "price_external_id": "price_external_id", "price_id": "price_id", "price_tier": []interface{}{map[string]interface{}{}}, "quantity": 1.1, "subscription_id": "subscription_id", "updated_at": "2024-01-15T09:30:00Z", "usage_type": "usage_type"}}, "status": "status", "subscription_external_id": "subscription_external_id", "total_price": 1}, "billing_subscriptions": []interface{}{map[string]interface{}{"cancel_at_period_end": true, "created_at": "2024-01-15T09:30:00Z", "currency": "currency", "customer_external_id": "customer_external_id", "discounts": []interface{}{map[string]interface{}{"coupon_id": "coupon_id", "coupon_name": "coupon_name", "discount_external_id": "discount_external_id", "duration": "duration", "is_active": true, "started_at": "2024-01-15T09:30:00Z", "subscription_external_id": "subscription_external_id"}}, "id": "id", "interval": "interval", "period_end": 1, "period_start": 1, "products": []interface{}{map[string]interface{}{"billing_scheme": "billing_scheme", "created_at": "2024-01-15T09:30:00Z", "currency": "currency", "environment_id": "environment_id", "external_id": "external_id", "id": "id", "interval": "interval", "name": "name", "package_size": 1, "price": 1, "price_external_id": "price_external_id", "price_id": "price_id", "price_tier": []interface{}{map[string]interface{}{}}, "quantity": 1.1, "subscription_id": "subscription_id", "updated_at": "2024-01-15T09:30:00Z", "usage_type": "usage_type"}}, "status": "status", "subscription_external_id": "subscription_external_id", "total_price": 1}}, "created_at": "2024-01-15T09:30:00Z", "default_payment_method": map[string]interface{}{"created_at": "2024-01-15T09:30:00Z", "customer_external_id": "customer_external_id", "environment_id": "environment_id", "external_id": "external_id", "id": "id", "payment_method_type": "payment_method_type", "updated_at": "2024-01-15T09:30:00Z"}, "entity_traits": []interface{}{map[string]interface{}{"created_at": "2024-01-15T09:30:00Z", "definition_id": "definition_id", "environment_id": "environment_id", "id": "id", "updated_at": "2024-01-15T09:30:00Z", "value": "value"}}, "environment_id": "environment_id", "id": "id", "keys": []interface{}{map[string]interface{}{"created_at": "2024-01-15T09:30:00Z", "definition_id": "definition_id", "entity_id": "entity_id", "entity_type": "entity_type", "environment_id": "environment_id", "id": "id", "key": "key", "updated_at": "2024-01-15T09:30:00Z", "value": "value"}}, "last_seen_at": "2024-01-15T09:30:00Z", "logo_url": "logo_url", "metrics": []interface{}{map[string]interface{}{"account_id": "account_id", "captured_at_max": "2024-01-15T09:30:00Z", "captured_at_min": "2024-01-15T09:30:00Z", "company_id": "company_id", "created_at": "2024-01-15T09:30:00Z", "environment_id": "environment_id", "event_subtype": "event_subtype", "month_reset": "month_reset", "period": "period", "value": 1}}, "name": "name", "payment_methods": []interface{}{map[string]interface{}{"created_at": "2024-01-15T09:30:00Z", "customer_external_id": "customer_external_id", "environment_id": "environment_id", "external_id": "external_id", "id": "id", "payment_method_type": "payment_method_type", "updated_at": "2024-01-15T09:30:00Z"}}, "plan": map[string]interface{}{"id": "id", "name": "name"}, "plans": []interface{}{map[string]interface{}{"id": "id", "name": "name"}}, "rules": []interface{}{map[string]interface{}{"account_id": "account_id", "condition_groups": []interface{}{map[string]interface{}{"conditions": []interface{}{map[string]interface{}{"account_id": "account_id", "condition_type": "base_plan", "environment_id": "environment_id", "id": "id", "operator": "eq", "resource_ids": []interface{}{"resource_ids"}, "trait_value": "trait_value"}}}}, "conditions": []interface{}{map[string]interface{}{"account_id": "account_id", "condition_type": "base_plan", "environment_id": "environment_id", "id": "id", "operator": "eq", "resource_ids": []interface{}{"resource_ids"}, "trait_value": "trait_value"}}, "environment_id": "environment_id", "id": "id", "name": "name", "priority": 1, "rule_type": "default", "value": true}}, "traits": map[string]interface{}{"key": "value"}, "updated_at": "2024-01-15T09:30:00Z", "user_count": 1}, "company_id": "company_id", "consumption_rate": 1.1, "created_at": "2024-01-15T09:30:00Z", "environment_id": "environment_id", "expiration_date": "2024-01-15T09:30:00Z", "feature": map[string]interface{}{"created_at": "2024-01-15T09:30:00Z", "description": "description", "event_subtype": "event_subtype", "feature_type": "feature_type", "icon": "icon", "id": "id", "lifecycle_phase": "lifecycle_phase", "maintainer_id": "maintainer_id", "name": "name", "plural_name": "plural_name", "singular_name": "singular_name", "trait_id": "trait_id", "updated_at": "2024-01-15T09:30:00Z"}, "feature_id": "feature_id", "id": "id", "metric_period": "metric_period", "metric_period_month_reset": "metric_period_month_reset", "notes": []interface{}{map[string]interface{}{"created_at": "2024-01-15T09:30:00Z", "external_user_id": "external_user_id", "external_user_name": "external_user_name", "id": "id", "note": "note", "updated_at": "2024-01-15T09:30:00Z"}}, "rule_id": "rule_id", "rule_id_usage_exceeded": "rule_id_usage_exceeded", "updated_at": "2024-01-15T09:30:00Z", "value_bool": true, "value_numeric": 1, "value_trait": map[string]interface{}{"created_at": "2024-01-15T09:30:00Z", "display_name": "display_name", "entity_type": "entity_type", "hierarchy": []interface{}{"hierarchy"}, "id": "id", "trait_type": "trait_type", "updated_at": "2024-01-15T09:30:00Z"}, "value_trait_id": "value_trait_id", "value_type": "value_type"}, "params": map[string]interface{}{"key": "value"}},
		).WithStatus(http.StatusOK),
	)
	err := WireMockClient.StubFor(stub)
	require.NoError(t, err, "Failed to create WireMock stub")

	client := client.NewSchematicClient(
		option.WithBaseURL(
			WireMockBaseURL,
		),
	)
	request := &schematichq.CreateCompanyOverrideRequestBody{
		CompanyID: "company_id",
		FeatureID: "feature_id",
		ValueType: schematichq.CreateCompanyOverrideRequestBodyValueTypeBoolean,
	}
	_, invocationErr := client.Entitlements.CreateCompanyOverride(
		context.TODO(),
		request,
	)

	require.NoError(t, invocationErr, "Client method call should succeed")
	ok, countErr := WireMockClient.Verify(stub.Request(), 1)
	require.NoError(t, countErr, "Failed to verify WireMock request was matched")
	require.True(t, ok, "WireMock request was not matched")
}

func TestEntitlementsGetCompanyOverrideWithWireMock(
	t *testing.T,
) {
	// wiremock client and server initialized in shared main_test.go
	defer WireMockClient.Reset()
	stub := gowiremock.Get(gowiremock.URLPathTemplate("/company-overrides/{company_override_id}")).WithPathParam(
		"company_override_id",
		gowiremock.Matching("company_override_id"),
	).WillReturnResponse(
		gowiremock.NewResponse().WithJSONBody(
			map[string]interface{}{"data": map[string]interface{}{"company": map[string]interface{}{"add_ons": []interface{}{map[string]interface{}{"id": "id", "name": "name"}}, "billing_credit_balances": map[string]interface{}{"key": 1.1}, "billing_subscription": map[string]interface{}{"cancel_at_period_end": true, "created_at": "2024-01-15T09:30:00Z", "currency": "currency", "customer_external_id": "customer_external_id", "discounts": []interface{}{map[string]interface{}{"coupon_id": "coupon_id", "coupon_name": "coupon_name", "discount_external_id": "discount_external_id", "duration": "duration", "is_active": true, "started_at": "2024-01-15T09:30:00Z", "subscription_external_id": "subscription_external_id"}}, "id": "id", "interval": "interval", "period_end": 1, "period_start": 1, "products": []interface{}{map[string]interface{}{"billing_scheme": "billing_scheme", "created_at": "2024-01-15T09:30:00Z", "currency": "currency", "environment_id": "environment_id", "external_id": "external_id", "id": "id", "interval": "interval", "name": "name", "package_size": 1, "price": 1, "price_external_id": "price_external_id", "price_id": "price_id", "price_tier": []interface{}{map[string]interface{}{}}, "quantity": 1.1, "subscription_id": "subscription_id", "updated_at": "2024-01-15T09:30:00Z", "usage_type": "usage_type"}}, "status": "status", "subscription_external_id": "subscription_external_id", "total_price": 1}, "billing_subscriptions": []interface{}{map[string]interface{}{"cancel_at_period_end": true, "created_at": "2024-01-15T09:30:00Z", "currency": "currency", "customer_external_id": "customer_external_id", "discounts": []interface{}{map[string]interface{}{"coupon_id": "coupon_id", "coupon_name": "coupon_name", "discount_external_id": "discount_external_id", "duration": "duration", "is_active": true, "started_at": "2024-01-15T09:30:00Z", "subscription_external_id": "subscription_external_id"}}, "id": "id", "interval": "interval", "period_end": 1, "period_start": 1, "products": []interface{}{map[string]interface{}{"billing_scheme": "billing_scheme", "created_at": "2024-01-15T09:30:00Z", "currency": "currency", "environment_id": "environment_id", "external_id": "external_id", "id": "id", "interval": "interval", "name": "name", "package_size": 1, "price": 1, "price_external_id": "price_external_id", "price_id": "price_id", "price_tier": []interface{}{map[string]interface{}{}}, "quantity": 1.1, "subscription_id": "subscription_id", "updated_at": "2024-01-15T09:30:00Z", "usage_type": "usage_type"}}, "status": "status", "subscription_external_id": "subscription_external_id", "total_price": 1}}, "created_at": "2024-01-15T09:30:00Z", "default_payment_method": map[string]interface{}{"created_at": "2024-01-15T09:30:00Z", "customer_external_id": "customer_external_id", "environment_id": "environment_id", "external_id": "external_id", "id": "id", "payment_method_type": "payment_method_type", "updated_at": "2024-01-15T09:30:00Z"}, "entity_traits": []interface{}{map[string]interface{}{"created_at": "2024-01-15T09:30:00Z", "definition_id": "definition_id", "environment_id": "environment_id", "id": "id", "updated_at": "2024-01-15T09:30:00Z", "value": "value"}}, "environment_id": "environment_id", "id": "id", "keys": []interface{}{map[string]interface{}{"created_at": "2024-01-15T09:30:00Z", "definition_id": "definition_id", "entity_id": "entity_id", "entity_type": "entity_type", "environment_id": "environment_id", "id": "id", "key": "key", "updated_at": "2024-01-15T09:30:00Z", "value": "value"}}, "last_seen_at": "2024-01-15T09:30:00Z", "logo_url": "logo_url", "metrics": []interface{}{map[string]interface{}{"account_id": "account_id", "captured_at_max": "2024-01-15T09:30:00Z", "captured_at_min": "2024-01-15T09:30:00Z", "company_id": "company_id", "created_at": "2024-01-15T09:30:00Z", "environment_id": "environment_id", "event_subtype": "event_subtype", "month_reset": "month_reset", "period": "period", "value": 1}}, "name": "name", "payment_methods": []interface{}{map[string]interface{}{"created_at": "2024-01-15T09:30:00Z", "customer_external_id": "customer_external_id", "environment_id": "environment_id", "external_id": "external_id", "id": "id", "payment_method_type": "payment_method_type", "updated_at": "2024-01-15T09:30:00Z"}}, "plan": map[string]interface{}{"id": "id", "name": "name"}, "plans": []interface{}{map[string]interface{}{"id": "id", "name": "name"}}, "rules": []interface{}{map[string]interface{}{"account_id": "account_id", "condition_groups": []interface{}{map[string]interface{}{"conditions": []interface{}{map[string]interface{}{"account_id": "account_id", "condition_type": "base_plan", "environment_id": "environment_id", "id": "id", "operator": "eq", "resource_ids": []interface{}{"resource_ids"}, "trait_value": "trait_value"}}}}, "conditions": []interface{}{map[string]interface{}{"account_id": "account_id", "condition_type": "base_plan", "environment_id": "environment_id", "id": "id", "operator": "eq", "resource_ids": []interface{}{"resource_ids"}, "trait_value": "trait_value"}}, "environment_id": "environment_id", "id": "id", "name": "name", "priority": 1, "rule_type": "default", "value": true}}, "traits": map[string]interface{}{"key": "value"}, "updated_at": "2024-01-15T09:30:00Z", "user_count": 1}, "company_id": "company_id", "consumption_rate": 1.1, "created_at": "2024-01-15T09:30:00Z", "environment_id": "environment_id", "expiration_date": "2024-01-15T09:30:00Z", "feature": map[string]interface{}{"created_at": "2024-01-15T09:30:00Z", "description": "description", "event_subtype": "event_subtype", "feature_type": "feature_type", "icon": "icon", "id": "id", "lifecycle_phase": "lifecycle_phase", "maintainer_id": "maintainer_id", "name": "name", "plural_name": "plural_name", "singular_name": "singular_name", "trait_id": "trait_id", "updated_at": "2024-01-15T09:30:00Z"}, "feature_id": "feature_id", "id": "id", "metric_period": "metric_period", "metric_period_month_reset": "metric_period_month_reset", "notes": []interface{}{map[string]interface{}{"created_at": "2024-01-15T09:30:00Z", "external_user_id": "external_user_id", "external_user_name": "external_user_name", "id": "id", "note": "note", "updated_at": "2024-01-15T09:30:00Z"}}, "rule_id": "rule_id", "rule_id_usage_exceeded": "rule_id_usage_exceeded", "updated_at": "2024-01-15T09:30:00Z", "value_bool": true, "value_numeric": 1, "value_trait": map[string]interface{}{"created_at": "2024-01-15T09:30:00Z", "display_name": "display_name", "entity_type": "entity_type", "hierarchy": []interface{}{"hierarchy"}, "id": "id", "trait_type": "trait_type", "updated_at": "2024-01-15T09:30:00Z"}, "value_trait_id": "value_trait_id", "value_type": "value_type"}, "params": map[string]interface{}{"key": "value"}},
		).WithStatus(http.StatusOK),
	)
	err := WireMockClient.StubFor(stub)
	require.NoError(t, err, "Failed to create WireMock stub")

	client := client.NewSchematicClient(
		option.WithBaseURL(
			WireMockBaseURL,
		),
	)
	_, invocationErr := client.Entitlements.GetCompanyOverride(
		context.TODO(),
		"company_override_id",
	)

	require.NoError(t, invocationErr, "Client method call should succeed")
	ok, countErr := WireMockClient.Verify(stub.Request(), 1)
	require.NoError(t, countErr, "Failed to verify WireMock request was matched")
	require.True(t, ok, "WireMock request was not matched")
}

func TestEntitlementsUpdateCompanyOverrideWithWireMock(
	t *testing.T,
) {
	// wiremock client and server initialized in shared main_test.go
	defer WireMockClient.Reset()
	stub := gowiremock.Put(gowiremock.URLPathTemplate("/company-overrides/{company_override_id}")).WithPathParam(
		"company_override_id",
		gowiremock.Matching("company_override_id"),
	).WithBodyPattern(gowiremock.MatchesJsonSchema(`{
                    "$schema": "https://json-schema.org/draft/2020-12/schema",
                    "type": "object",
                    "required": ["value_type"],
                    "properties": {
                        "value_type": {"type": "string"}
                    },
                    "additionalProperties": true
                }`, "V202012")).WillReturnResponse(
		gowiremock.NewResponse().WithJSONBody(
			map[string]interface{}{"data": map[string]interface{}{"company": map[string]interface{}{"add_ons": []interface{}{map[string]interface{}{"id": "id", "name": "name"}}, "billing_credit_balances": map[string]interface{}{"key": 1.1}, "billing_subscription": map[string]interface{}{"cancel_at_period_end": true, "created_at": "2024-01-15T09:30:00Z", "currency": "currency", "customer_external_id": "customer_external_id", "discounts": []interface{}{map[string]interface{}{"coupon_id": "coupon_id", "coupon_name": "coupon_name", "discount_external_id": "discount_external_id", "duration": "duration", "is_active": true, "started_at": "2024-01-15T09:30:00Z", "subscription_external_id": "subscription_external_id"}}, "id": "id", "interval": "interval", "period_end": 1, "period_start": 1, "products": []interface{}{map[string]interface{}{"billing_scheme": "billing_scheme", "created_at": "2024-01-15T09:30:00Z", "currency": "currency", "environment_id": "environment_id", "external_id": "external_id", "id": "id", "interval": "interval", "name": "name", "package_size": 1, "price": 1, "price_external_id": "price_external_id", "price_id": "price_id", "price_tier": []interface{}{map[string]interface{}{}}, "quantity": 1.1, "subscription_id": "subscription_id", "updated_at": "2024-01-15T09:30:00Z", "usage_type": "usage_type"}}, "status": "status", "subscription_external_id": "subscription_external_id", "total_price": 1}, "billing_subscriptions": []interface{}{map[string]interface{}{"cancel_at_period_end": true, "created_at": "2024-01-15T09:30:00Z", "currency": "currency", "customer_external_id": "customer_external_id", "discounts": []interface{}{map[string]interface{}{"coupon_id": "coupon_id", "coupon_name": "coupon_name", "discount_external_id": "discount_external_id", "duration": "duration", "is_active": true, "started_at": "2024-01-15T09:30:00Z", "subscription_external_id": "subscription_external_id"}}, "id": "id", "interval": "interval", "period_end": 1, "period_start": 1, "products": []interface{}{map[string]interface{}{"billing_scheme": "billing_scheme", "created_at": "2024-01-15T09:30:00Z", "currency": "currency", "environment_id": "environment_id", "external_id": "external_id", "id": "id", "interval": "interval", "name": "name", "package_size": 1, "price": 1, "price_external_id": "price_external_id", "price_id": "price_id", "price_tier": []interface{}{map[string]interface{}{}}, "quantity": 1.1, "subscription_id": "subscription_id", "updated_at": "2024-01-15T09:30:00Z", "usage_type": "usage_type"}}, "status": "status", "subscription_external_id": "subscription_external_id", "total_price": 1}}, "created_at": "2024-01-15T09:30:00Z", "default_payment_method": map[string]interface{}{"created_at": "2024-01-15T09:30:00Z", "customer_external_id": "customer_external_id", "environment_id": "environment_id", "external_id": "external_id", "id": "id", "payment_method_type": "payment_method_type", "updated_at": "2024-01-15T09:30:00Z"}, "entity_traits": []interface{}{map[string]interface{}{"created_at": "2024-01-15T09:30:00Z", "definition_id": "definition_id", "environment_id": "environment_id", "id": "id", "updated_at": "2024-01-15T09:30:00Z", "value": "value"}}, "environment_id": "environment_id", "id": "id", "keys": []interface{}{map[string]interface{}{"created_at": "2024-01-15T09:30:00Z", "definition_id": "definition_id", "entity_id": "entity_id", "entity_type": "entity_type", "environment_id": "environment_id", "id": "id", "key": "key", "updated_at": "2024-01-15T09:30:00Z", "value": "value"}}, "last_seen_at": "2024-01-15T09:30:00Z", "logo_url": "logo_url", "metrics": []interface{}{map[string]interface{}{"account_id": "account_id", "captured_at_max": "2024-01-15T09:30:00Z", "captured_at_min": "2024-01-15T09:30:00Z", "company_id": "company_id", "created_at": "2024-01-15T09:30:00Z", "environment_id": "environment_id", "event_subtype": "event_subtype", "month_reset": "month_reset", "period": "period", "value": 1}}, "name": "name", "payment_methods": []interface{}{map[string]interface{}{"created_at": "2024-01-15T09:30:00Z", "customer_external_id": "customer_external_id", "environment_id": "environment_id", "external_id": "external_id", "id": "id", "payment_method_type": "payment_method_type", "updated_at": "2024-01-15T09:30:00Z"}}, "plan": map[string]interface{}{"id": "id", "name": "name"}, "plans": []interface{}{map[string]interface{}{"id": "id", "name": "name"}}, "rules": []interface{}{map[string]interface{}{"account_id": "account_id", "condition_groups": []interface{}{map[string]interface{}{"conditions": []interface{}{map[string]interface{}{"account_id": "account_id", "condition_type": "base_plan", "environment_id": "environment_id", "id": "id", "operator": "eq", "resource_ids": []interface{}{"resource_ids"}, "trait_value": "trait_value"}}}}, "conditions": []interface{}{map[string]interface{}{"account_id": "account_id", "condition_type": "base_plan", "environment_id": "environment_id", "id": "id", "operator": "eq", "resource_ids": []interface{}{"resource_ids"}, "trait_value": "trait_value"}}, "environment_id": "environment_id", "id": "id", "name": "name", "priority": 1, "rule_type": "default", "value": true}}, "traits": map[string]interface{}{"key": "value"}, "updated_at": "2024-01-15T09:30:00Z", "user_count": 1}, "company_id": "company_id", "consumption_rate": 1.1, "created_at": "2024-01-15T09:30:00Z", "environment_id": "environment_id", "expiration_date": "2024-01-15T09:30:00Z", "feature": map[string]interface{}{"created_at": "2024-01-15T09:30:00Z", "description": "description", "event_subtype": "event_subtype", "feature_type": "feature_type", "icon": "icon", "id": "id", "lifecycle_phase": "lifecycle_phase", "maintainer_id": "maintainer_id", "name": "name", "plural_name": "plural_name", "singular_name": "singular_name", "trait_id": "trait_id", "updated_at": "2024-01-15T09:30:00Z"}, "feature_id": "feature_id", "id": "id", "metric_period": "metric_period", "metric_period_month_reset": "metric_period_month_reset", "notes": []interface{}{map[string]interface{}{"created_at": "2024-01-15T09:30:00Z", "external_user_id": "external_user_id", "external_user_name": "external_user_name", "id": "id", "note": "note", "updated_at": "2024-01-15T09:30:00Z"}}, "rule_id": "rule_id", "rule_id_usage_exceeded": "rule_id_usage_exceeded", "updated_at": "2024-01-15T09:30:00Z", "value_bool": true, "value_numeric": 1, "value_trait": map[string]interface{}{"created_at": "2024-01-15T09:30:00Z", "display_name": "display_name", "entity_type": "entity_type", "hierarchy": []interface{}{"hierarchy"}, "id": "id", "trait_type": "trait_type", "updated_at": "2024-01-15T09:30:00Z"}, "value_trait_id": "value_trait_id", "value_type": "value_type"}, "params": map[string]interface{}{"key": "value"}},
		).WithStatus(http.StatusOK),
	)
	err := WireMockClient.StubFor(stub)
	require.NoError(t, err, "Failed to create WireMock stub")

	client := client.NewSchematicClient(
		option.WithBaseURL(
			WireMockBaseURL,
		),
	)
	request := &schematichq.UpdateCompanyOverrideRequestBody{
		ValueType: schematichq.UpdateCompanyOverrideRequestBodyValueTypeBoolean,
	}
	_, invocationErr := client.Entitlements.UpdateCompanyOverride(
		context.TODO(),
		"company_override_id",
		request,
	)

	require.NoError(t, invocationErr, "Client method call should succeed")
	ok, countErr := WireMockClient.Verify(stub.Request(), 1)
	require.NoError(t, countErr, "Failed to verify WireMock request was matched")
	require.True(t, ok, "WireMock request was not matched")
}

func TestEntitlementsDeleteCompanyOverrideWithWireMock(
	t *testing.T,
) {
	// wiremock client and server initialized in shared main_test.go
	defer WireMockClient.Reset()
	stub := gowiremock.Delete(gowiremock.URLPathTemplate("/company-overrides/{company_override_id}")).WithPathParam(
		"company_override_id",
		gowiremock.Matching("company_override_id"),
	).WillReturnResponse(
		gowiremock.NewResponse().WithJSONBody(
			map[string]interface{}{"data": map[string]interface{}{"deleted": true}, "params": map[string]interface{}{"key": "value"}},
		).WithStatus(http.StatusOK),
	)
	err := WireMockClient.StubFor(stub)
	require.NoError(t, err, "Failed to create WireMock stub")

	client := client.NewSchematicClient(
		option.WithBaseURL(
			WireMockBaseURL,
		),
	)
	_, invocationErr := client.Entitlements.DeleteCompanyOverride(
		context.TODO(),
		"company_override_id",
	)

	require.NoError(t, invocationErr, "Client method call should succeed")
	ok, countErr := WireMockClient.Verify(stub.Request(), 1)
	require.NoError(t, countErr, "Failed to verify WireMock request was matched")
	require.True(t, ok, "WireMock request was not matched")
}

func TestEntitlementsCountCompanyOverridesWithWireMock(
	t *testing.T,
) {
	// wiremock client and server initialized in shared main_test.go
	defer WireMockClient.Reset()
	stub := gowiremock.Get(gowiremock.URLPathTemplate("/company-overrides/count")).WillReturnResponse(
		gowiremock.NewResponse().WithJSONBody(
			map[string]interface{}{"data": map[string]interface{}{"count": 1}, "params": map[string]interface{}{"company_id": "company_id", "company_ids": []interface{}{"company_ids"}, "feature_id": "feature_id", "feature_ids": []interface{}{"feature_ids"}, "ids": []interface{}{"ids"}, "limit": 1, "offset": 1, "q": "q", "without_expired": true}},
		).WithStatus(http.StatusOK),
	)
	err := WireMockClient.StubFor(stub)
	require.NoError(t, err, "Failed to create WireMock stub")

	client := client.NewSchematicClient(
		option.WithBaseURL(
			WireMockBaseURL,
		),
	)
	request := &schematichq.CountCompanyOverridesRequest{
		CompanyID: schematichq.String(
			"company_id",
		),
		FeatureID: schematichq.String(
			"feature_id",
		),
		WithoutExpired: schematichq.Bool(
			true,
		),
		Q: schematichq.String(
			"q",
		),
		Limit: schematichq.Int(
			1,
		),
		Offset: schematichq.Int(
			1,
		),
	}
	_, invocationErr := client.Entitlements.CountCompanyOverrides(
		context.TODO(),
		request,
	)

	require.NoError(t, invocationErr, "Client method call should succeed")
	ok, countErr := WireMockClient.Verify(stub.Request(), 1)
	require.NoError(t, countErr, "Failed to verify WireMock request was matched")
	require.True(t, ok, "WireMock request was not matched")
}

func TestEntitlementsListFeatureCompaniesWithWireMock(
	t *testing.T,
) {
	// wiremock client and server initialized in shared main_test.go
	defer WireMockClient.Reset()
	stub := gowiremock.Get(gowiremock.URLPathTemplate("/feature-companies")).WillReturnResponse(
		gowiremock.NewResponse().WithJSONBody(
			map[string]interface{}{"data": []interface{}{map[string]interface{}{"access": true, "allocation": 1, "allocation_type": "boolean", "company": map[string]interface{}{"add_ons": []interface{}{map[string]interface{}{"id": "id", "name": "name"}}, "billing_subscriptions": []interface{}{map[string]interface{}{"cancel_at_period_end": true, "created_at": "2024-01-15T09:30:00Z", "currency": "currency", "customer_external_id": "customer_external_id", "discounts": []interface{}{map[string]interface{}{"coupon_id": "coupon_id", "coupon_name": "coupon_name", "discount_external_id": "discount_external_id", "duration": "duration", "is_active": true, "started_at": "2024-01-15T09:30:00Z", "subscription_external_id": "subscription_external_id"}}, "id": "id", "interval": "interval", "period_end": 1, "period_start": 1, "products": []interface{}{map[string]interface{}{"billing_scheme": "billing_scheme", "created_at": "2024-01-15T09:30:00Z", "currency": "currency", "environment_id": "environment_id", "external_id": "external_id", "id": "id", "interval": "interval", "name": "name", "package_size": 1, "price": 1, "price_external_id": "price_external_id", "price_id": "price_id", "price_tier": []interface{}{map[string]interface{}{}}, "quantity": 1.1, "subscription_id": "subscription_id", "updated_at": "2024-01-15T09:30:00Z", "usage_type": "usage_type"}}, "status": "status", "subscription_external_id": "subscription_external_id", "total_price": 1}}, "created_at": "2024-01-15T09:30:00Z", "entity_traits": []interface{}{map[string]interface{}{"created_at": "2024-01-15T09:30:00Z", "definition_id": "definition_id", "environment_id": "environment_id", "id": "id", "updated_at": "2024-01-15T09:30:00Z", "value": "value"}}, "environment_id": "environment_id", "id": "id", "keys": []interface{}{map[string]interface{}{"created_at": "2024-01-15T09:30:00Z", "definition_id": "definition_id", "entity_id": "entity_id", "entity_type": "entity_type", "environment_id": "environment_id", "id": "id", "key": "key", "updated_at": "2024-01-15T09:30:00Z", "value": "value"}}, "metrics": []interface{}{map[string]interface{}{"account_id": "account_id", "captured_at_max": "2024-01-15T09:30:00Z", "captured_at_min": "2024-01-15T09:30:00Z", "company_id": "company_id", "created_at": "2024-01-15T09:30:00Z", "environment_id": "environment_id", "event_subtype": "event_subtype", "month_reset": "month_reset", "period": "period", "value": 1}}, "name": "name", "payment_methods": []interface{}{map[string]interface{}{"created_at": "2024-01-15T09:30:00Z", "customer_external_id": "customer_external_id", "environment_id": "environment_id", "external_id": "external_id", "id": "id", "payment_method_type": "payment_method_type", "updated_at": "2024-01-15T09:30:00Z"}}, "plans": []interface{}{map[string]interface{}{"id": "id", "name": "name"}}, "rules": []interface{}{map[string]interface{}{"account_id": "account_id", "condition_groups": []interface{}{map[string]interface{}{"conditions": []interface{}{map[string]interface{}{"account_id": "account_id", "condition_type": "base_plan", "environment_id": "environment_id", "id": "id", "operator": "eq", "resource_ids": []interface{}{"resource_ids"}, "trait_value": "trait_value"}}}}, "conditions": []interface{}{map[string]interface{}{"account_id": "account_id", "condition_type": "base_plan", "environment_id": "environment_id", "id": "id", "operator": "eq", "resource_ids": []interface{}{"resource_ids"}, "trait_value": "trait_value"}}, "environment_id": "environment_id", "id": "id", "name": "name", "priority": 1, "rule_type": "default", "value": true}}, "updated_at": "2024-01-15T09:30:00Z", "user_count": 1}, "company_override": map[string]interface{}{"company_id": "company_id", "created_at": "2024-01-15T09:30:00Z", "environment_id": "environment_id", "feature_id": "feature_id", "id": "id", "notes": []interface{}{map[string]interface{}{"created_at": "2024-01-15T09:30:00Z", "external_user_id": "external_user_id", "external_user_name": "external_user_name", "id": "id", "note": "note", "updated_at": "2024-01-15T09:30:00Z"}}, "updated_at": "2024-01-15T09:30:00Z", "value_type": "value_type"}, "credit_consumption_rate": 1.1, "credit_grant_counts": map[string]interface{}{"key": 1.1}, "credit_grant_details": []interface{}{map[string]interface{}{"grant_reason": "free", "quantity": 1.1}}, "credit_grant_reason": "free", "credit_remaining": 1.1, "credit_total": 1.1, "credit_type_icon": "credit_type_icon", "credit_used": 1.1, "effective_limit": 1, "effective_price": 1.1, "entitlement_expiration_date": "2024-01-15T09:30:00Z", "entitlement_id": "entitlement_id", "entitlement_source": "entitlement_source", "entitlement_type": "entitlement_type", "feature": map[string]interface{}{"created_at": "2024-01-15T09:30:00Z", "description": "description", "feature_type": "feature_type", "flags": []interface{}{map[string]interface{}{"created_at": "2024-01-15T09:30:00Z", "default_value": true, "description": "description", "flag_type": "flag_type", "id": "id", "key": "key", "name": "name", "rules": []interface{}{map[string]interface{}{"condition_groups": []interface{}{map[string]interface{}{"conditions": []interface{}{map[string]interface{}{"condition_type": "condition_type", "created_at": "2024-01-15T09:30:00Z", "environment_id": "environment_id", "id": "id", "operator": "operator", "resource_ids": []interface{}{"resource_ids"}, "resources": []interface{}{map[string]interface{}{"id": "id", "name": "name"}}, "rule_id": "rule_id", "trait_value": "trait_value", "updated_at": "2024-01-15T09:30:00Z"}}, "created_at": "2024-01-15T09:30:00Z", "environment_id": "environment_id", "id": "id", "rule_id": "rule_id", "updated_at": "2024-01-15T09:30:00Z"}}, "conditions": []interface{}{map[string]interface{}{"condition_type": "condition_type", "created_at": "2024-01-15T09:30:00Z", "environment_id": "environment_id", "id": "id", "operator": "operator", "resource_ids": []interface{}{"resource_ids"}, "resources": []interface{}{map[string]interface{}{"id": "id", "name": "name"}}, "rule_id": "rule_id", "trait_value": "trait_value", "updated_at": "2024-01-15T09:30:00Z"}}, "created_at": "2024-01-15T09:30:00Z", "environment_id": "environment_id", "id": "id", "name": "name", "priority": 1, "rule_type": "rule_type", "updated_at": "2024-01-15T09:30:00Z", "value": true}}, "updated_at": "2024-01-15T09:30:00Z"}}, "icon": "icon", "id": "id", "name": "name", "plans": []interface{}{map[string]interface{}{"id": "id", "name": "name"}}, "updated_at": "2024-01-15T09:30:00Z"}, "has_valid_allocation": true, "is_unlimited": true, "metric_reset_at": "2024-01-15T09:30:00Z", "month_reset": "month_reset", "monthly_usage_based_price": map[string]interface{}{"billing_scheme": "billing_scheme", "created_at": "2024-01-15T09:30:00Z", "currency": "currency", "id": "id", "interval": "interval", "is_active": true, "package_size": 1, "price": 1, "price_external_id": "price_external_id", "price_id": "price_id", "price_tier": []interface{}{map[string]interface{}{}}, "product_external_id": "product_external_id", "product_id": "product_id", "product_name": "product_name", "updated_at": "2024-01-15T09:30:00Z", "usage_type": "usage_type"}, "overuse": 1, "percent_used": 1.1, "period": "period", "plan": map[string]interface{}{"created_at": "2024-01-15T09:30:00Z", "description": "description", "icon": "icon", "id": "id", "name": "name", "plan_type": "plan_type", "updated_at": "2024-01-15T09:30:00Z"}, "plan_entitlement": map[string]interface{}{"created_at": "2024-01-15T09:30:00Z", "environment_id": "environment_id", "feature_id": "feature_id", "id": "id", "plan_id": "plan_id", "rule_id": "rule_id", "updated_at": "2024-01-15T09:30:00Z", "value_type": "value_type"}, "price_behavior": "price_behavior", "soft_limit": 1, "usage": 1, "yearly_usage_based_price": map[string]interface{}{"billing_scheme": "billing_scheme", "created_at": "2024-01-15T09:30:00Z", "currency": "currency", "id": "id", "interval": "interval", "is_active": true, "package_size": 1, "price": 1, "price_external_id": "price_external_id", "price_id": "price_id", "price_tier": []interface{}{map[string]interface{}{}}, "product_external_id": "product_external_id", "product_id": "product_id", "product_name": "product_name", "updated_at": "2024-01-15T09:30:00Z", "usage_type": "usage_type"}}}, "params": map[string]interface{}{"feature_id": "feature_id", "limit": 1, "offset": 1, "q": "q"}},
		).WithStatus(http.StatusOK),
	)
	err := WireMockClient.StubFor(stub)
	require.NoError(t, err, "Failed to create WireMock stub")

	client := client.NewSchematicClient(
		option.WithBaseURL(
			WireMockBaseURL,
		),
	)
	request := &schematichq.ListFeatureCompaniesRequest{
		FeatureID: "feature_id",
		Q: schematichq.String(
			"q",
		),
		Limit: schematichq.Int(
			1,
		),
		Offset: schematichq.Int(
			1,
		),
	}
	_, invocationErr := client.Entitlements.ListFeatureCompanies(
		context.TODO(),
		request,
	)

	require.NoError(t, invocationErr, "Client method call should succeed")
	ok, countErr := WireMockClient.Verify(stub.Request(), 1)
	require.NoError(t, countErr, "Failed to verify WireMock request was matched")
	require.True(t, ok, "WireMock request was not matched")
}

func TestEntitlementsCountFeatureCompaniesWithWireMock(
	t *testing.T,
) {
	// wiremock client and server initialized in shared main_test.go
	defer WireMockClient.Reset()
	stub := gowiremock.Get(gowiremock.URLPathTemplate("/feature-companies/count")).WillReturnResponse(
		gowiremock.NewResponse().WithJSONBody(
			map[string]interface{}{"data": map[string]interface{}{"count": 1}, "params": map[string]interface{}{"feature_id": "feature_id", "limit": 1, "offset": 1, "q": "q"}},
		).WithStatus(http.StatusOK),
	)
	err := WireMockClient.StubFor(stub)
	require.NoError(t, err, "Failed to create WireMock stub")

	client := client.NewSchematicClient(
		option.WithBaseURL(
			WireMockBaseURL,
		),
	)
	request := &schematichq.CountFeatureCompaniesRequest{
		FeatureID: "feature_id",
		Q: schematichq.String(
			"q",
		),
		Limit: schematichq.Int(
			1,
		),
		Offset: schematichq.Int(
			1,
		),
	}
	_, invocationErr := client.Entitlements.CountFeatureCompanies(
		context.TODO(),
		request,
	)

	require.NoError(t, invocationErr, "Client method call should succeed")
	ok, countErr := WireMockClient.Verify(stub.Request(), 1)
	require.NoError(t, countErr, "Failed to verify WireMock request was matched")
	require.True(t, ok, "WireMock request was not matched")
}

func TestEntitlementsListFeatureUsageWithWireMock(
	t *testing.T,
) {
	// wiremock client and server initialized in shared main_test.go
	defer WireMockClient.Reset()
	stub := gowiremock.Get(gowiremock.URLPathTemplate("/feature-usage")).WillReturnResponse(
		gowiremock.NewResponse().WithJSONBody(
			map[string]interface{}{"data": []interface{}{map[string]interface{}{"access": true, "allocation": 1, "allocation_type": "boolean", "company_override": map[string]interface{}{"company_id": "company_id", "created_at": "2024-01-15T09:30:00Z", "environment_id": "environment_id", "feature_id": "feature_id", "id": "id", "notes": []interface{}{map[string]interface{}{"created_at": "2024-01-15T09:30:00Z", "external_user_id": "external_user_id", "external_user_name": "external_user_name", "id": "id", "note": "note", "updated_at": "2024-01-15T09:30:00Z"}}, "updated_at": "2024-01-15T09:30:00Z", "value_type": "value_type"}, "credit_consumption_rate": 1.1, "credit_grant_counts": map[string]interface{}{"key": 1.1}, "credit_grant_details": []interface{}{map[string]interface{}{"grant_reason": "free", "quantity": 1.1}}, "credit_grant_reason": "free", "credit_remaining": 1.1, "credit_total": 1.1, "credit_type_icon": "credit_type_icon", "credit_used": 1.1, "effective_limit": 1, "effective_price": 1.1, "entitlement_expiration_date": "2024-01-15T09:30:00Z", "entitlement_id": "entitlement_id", "entitlement_source": "entitlement_source", "entitlement_type": "entitlement_type", "feature": map[string]interface{}{"created_at": "2024-01-15T09:30:00Z", "description": "description", "feature_type": "feature_type", "flags": []interface{}{map[string]interface{}{"created_at": "2024-01-15T09:30:00Z", "default_value": true, "description": "description", "flag_type": "flag_type", "id": "id", "key": "key", "name": "name", "rules": []interface{}{map[string]interface{}{"condition_groups": []interface{}{map[string]interface{}{"conditions": []interface{}{map[string]interface{}{"condition_type": "condition_type", "created_at": "2024-01-15T09:30:00Z", "environment_id": "environment_id", "id": "id", "operator": "operator", "resource_ids": []interface{}{"resource_ids"}, "resources": []interface{}{map[string]interface{}{"id": "id", "name": "name"}}, "rule_id": "rule_id", "trait_value": "trait_value", "updated_at": "2024-01-15T09:30:00Z"}}, "created_at": "2024-01-15T09:30:00Z", "environment_id": "environment_id", "id": "id", "rule_id": "rule_id", "updated_at": "2024-01-15T09:30:00Z"}}, "conditions": []interface{}{map[string]interface{}{"condition_type": "condition_type", "created_at": "2024-01-15T09:30:00Z", "environment_id": "environment_id", "id": "id", "operator": "operator", "resource_ids": []interface{}{"resource_ids"}, "resources": []interface{}{map[string]interface{}{"id": "id", "name": "name"}}, "rule_id": "rule_id", "trait_value": "trait_value", "updated_at": "2024-01-15T09:30:00Z"}}, "created_at": "2024-01-15T09:30:00Z", "environment_id": "environment_id", "id": "id", "name": "name", "priority": 1, "rule_type": "rule_type", "updated_at": "2024-01-15T09:30:00Z", "value": true}}, "updated_at": "2024-01-15T09:30:00Z"}}, "icon": "icon", "id": "id", "name": "name", "plans": []interface{}{map[string]interface{}{"id": "id", "name": "name"}}, "updated_at": "2024-01-15T09:30:00Z"}, "has_valid_allocation": true, "is_unlimited": true, "metric_reset_at": "2024-01-15T09:30:00Z", "month_reset": "month_reset", "monthly_usage_based_price": map[string]interface{}{"billing_scheme": "billing_scheme", "created_at": "2024-01-15T09:30:00Z", "currency": "currency", "id": "id", "interval": "interval", "is_active": true, "package_size": 1, "price": 1, "price_external_id": "price_external_id", "price_id": "price_id", "price_tier": []interface{}{map[string]interface{}{}}, "product_external_id": "product_external_id", "product_id": "product_id", "product_name": "product_name", "updated_at": "2024-01-15T09:30:00Z", "usage_type": "usage_type"}, "overuse": 1, "percent_used": 1.1, "period": "period", "plan": map[string]interface{}{"created_at": "2024-01-15T09:30:00Z", "description": "description", "icon": "icon", "id": "id", "name": "name", "plan_type": "plan_type", "updated_at": "2024-01-15T09:30:00Z"}, "plan_entitlement": map[string]interface{}{"created_at": "2024-01-15T09:30:00Z", "environment_id": "environment_id", "feature_id": "feature_id", "id": "id", "plan_id": "plan_id", "rule_id": "rule_id", "updated_at": "2024-01-15T09:30:00Z", "value_type": "value_type"}, "price_behavior": "price_behavior", "soft_limit": 1, "usage": 1, "yearly_usage_based_price": map[string]interface{}{"billing_scheme": "billing_scheme", "created_at": "2024-01-15T09:30:00Z", "currency": "currency", "id": "id", "interval": "interval", "is_active": true, "package_size": 1, "price": 1, "price_external_id": "price_external_id", "price_id": "price_id", "price_tier": []interface{}{map[string]interface{}{}}, "product_external_id": "product_external_id", "product_id": "product_id", "product_name": "product_name", "updated_at": "2024-01-15T09:30:00Z", "usage_type": "usage_type"}}}, "params": map[string]interface{}{"company_id": "company_id", "company_keys": map[string]interface{}{"key": "value"}, "feature_ids": []interface{}{"feature_ids"}, "limit": 1, "offset": 1, "q": "q", "without_negative_entitlements": true}},
		).WithStatus(http.StatusOK),
	)
	err := WireMockClient.StubFor(stub)
	require.NoError(t, err, "Failed to create WireMock stub")

	client := client.NewSchematicClient(
		option.WithBaseURL(
			WireMockBaseURL,
		),
	)
	request := &schematichq.ListFeatureUsageRequest{
		CompanyID: schematichq.String(
			"company_id",
		),
		Q: schematichq.String(
			"q",
		),
		WithoutNegativeEntitlements: schematichq.Bool(
			true,
		),
		Limit: schematichq.Int(
			1,
		),
		Offset: schematichq.Int(
			1,
		),
	}
	_, invocationErr := client.Entitlements.ListFeatureUsage(
		context.TODO(),
		request,
	)

	require.NoError(t, invocationErr, "Client method call should succeed")
	ok, countErr := WireMockClient.Verify(stub.Request(), 1)
	require.NoError(t, countErr, "Failed to verify WireMock request was matched")
	require.True(t, ok, "WireMock request was not matched")
}

func TestEntitlementsCountFeatureUsageWithWireMock(
	t *testing.T,
) {
	// wiremock client and server initialized in shared main_test.go
	defer WireMockClient.Reset()
	stub := gowiremock.Get(gowiremock.URLPathTemplate("/feature-usage/count")).WillReturnResponse(
		gowiremock.NewResponse().WithJSONBody(
			map[string]interface{}{"data": map[string]interface{}{"count": 1}, "params": map[string]interface{}{"company_id": "company_id", "company_keys": map[string]interface{}{"key": "value"}, "feature_ids": []interface{}{"feature_ids"}, "limit": 1, "offset": 1, "q": "q", "without_negative_entitlements": true}},
		).WithStatus(http.StatusOK),
	)
	err := WireMockClient.StubFor(stub)
	require.NoError(t, err, "Failed to create WireMock stub")

	client := client.NewSchematicClient(
		option.WithBaseURL(
			WireMockBaseURL,
		),
	)
	request := &schematichq.CountFeatureUsageRequest{
		CompanyID: schematichq.String(
			"company_id",
		),
		Q: schematichq.String(
			"q",
		),
		WithoutNegativeEntitlements: schematichq.Bool(
			true,
		),
		Limit: schematichq.Int(
			1,
		),
		Offset: schematichq.Int(
			1,
		),
	}
	_, invocationErr := client.Entitlements.CountFeatureUsage(
		context.TODO(),
		request,
	)

	require.NoError(t, invocationErr, "Client method call should succeed")
	ok, countErr := WireMockClient.Verify(stub.Request(), 1)
	require.NoError(t, countErr, "Failed to verify WireMock request was matched")
	require.True(t, ok, "WireMock request was not matched")
}

func TestEntitlementsListFeatureUsersWithWireMock(
	t *testing.T,
) {
	// wiremock client and server initialized in shared main_test.go
	defer WireMockClient.Reset()
	stub := gowiremock.Get(gowiremock.URLPathTemplate("/feature-users")).WillReturnResponse(
		gowiremock.NewResponse().WithJSONBody(
			map[string]interface{}{"data": []interface{}{map[string]interface{}{"access": true, "allocation": 1, "allocation_type": "boolean", "company": map[string]interface{}{"add_ons": []interface{}{map[string]interface{}{"id": "id", "name": "name"}}, "billing_subscriptions": []interface{}{map[string]interface{}{"cancel_at_period_end": true, "created_at": "2024-01-15T09:30:00Z", "currency": "currency", "customer_external_id": "customer_external_id", "discounts": []interface{}{map[string]interface{}{"coupon_id": "coupon_id", "coupon_name": "coupon_name", "discount_external_id": "discount_external_id", "duration": "duration", "is_active": true, "started_at": "2024-01-15T09:30:00Z", "subscription_external_id": "subscription_external_id"}}, "id": "id", "interval": "interval", "period_end": 1, "period_start": 1, "products": []interface{}{map[string]interface{}{"billing_scheme": "billing_scheme", "created_at": "2024-01-15T09:30:00Z", "currency": "currency", "environment_id": "environment_id", "external_id": "external_id", "id": "id", "interval": "interval", "name": "name", "package_size": 1, "price": 1, "price_external_id": "price_external_id", "price_id": "price_id", "price_tier": []interface{}{map[string]interface{}{}}, "quantity": 1.1, "subscription_id": "subscription_id", "updated_at": "2024-01-15T09:30:00Z", "usage_type": "usage_type"}}, "status": "status", "subscription_external_id": "subscription_external_id", "total_price": 1}}, "created_at": "2024-01-15T09:30:00Z", "entity_traits": []interface{}{map[string]interface{}{"created_at": "2024-01-15T09:30:00Z", "definition_id": "definition_id", "environment_id": "environment_id", "id": "id", "updated_at": "2024-01-15T09:30:00Z", "value": "value"}}, "environment_id": "environment_id", "id": "id", "keys": []interface{}{map[string]interface{}{"created_at": "2024-01-15T09:30:00Z", "definition_id": "definition_id", "entity_id": "entity_id", "entity_type": "entity_type", "environment_id": "environment_id", "id": "id", "key": "key", "updated_at": "2024-01-15T09:30:00Z", "value": "value"}}, "metrics": []interface{}{map[string]interface{}{"account_id": "account_id", "captured_at_max": "2024-01-15T09:30:00Z", "captured_at_min": "2024-01-15T09:30:00Z", "company_id": "company_id", "created_at": "2024-01-15T09:30:00Z", "environment_id": "environment_id", "event_subtype": "event_subtype", "month_reset": "month_reset", "period": "period", "value": 1}}, "name": "name", "payment_methods": []interface{}{map[string]interface{}{"created_at": "2024-01-15T09:30:00Z", "customer_external_id": "customer_external_id", "environment_id": "environment_id", "external_id": "external_id", "id": "id", "payment_method_type": "payment_method_type", "updated_at": "2024-01-15T09:30:00Z"}}, "plans": []interface{}{map[string]interface{}{"id": "id", "name": "name"}}, "rules": []interface{}{map[string]interface{}{"account_id": "account_id", "condition_groups": []interface{}{map[string]interface{}{"conditions": []interface{}{map[string]interface{}{"account_id": "account_id", "condition_type": "base_plan", "environment_id": "environment_id", "id": "id", "operator": "eq", "resource_ids": []interface{}{"resource_ids"}, "trait_value": "trait_value"}}}}, "conditions": []interface{}{map[string]interface{}{"account_id": "account_id", "condition_type": "base_plan", "environment_id": "environment_id", "id": "id", "operator": "eq", "resource_ids": []interface{}{"resource_ids"}, "trait_value": "trait_value"}}, "environment_id": "environment_id", "id": "id", "name": "name", "priority": 1, "rule_type": "default", "value": true}}, "updated_at": "2024-01-15T09:30:00Z", "user_count": 1}, "entitlement_id": "entitlement_id", "entitlement_type": "entitlement_type", "feature": map[string]interface{}{"created_at": "2024-01-15T09:30:00Z", "description": "description", "feature_type": "feature_type", "flags": []interface{}{map[string]interface{}{"created_at": "2024-01-15T09:30:00Z", "default_value": true, "description": "description", "flag_type": "flag_type", "id": "id", "key": "key", "name": "name", "rules": []interface{}{map[string]interface{}{"condition_groups": []interface{}{map[string]interface{}{"conditions": []interface{}{map[string]interface{}{"condition_type": "condition_type", "created_at": "2024-01-15T09:30:00Z", "environment_id": "environment_id", "id": "id", "operator": "operator", "resource_ids": []interface{}{"resource_ids"}, "resources": []interface{}{map[string]interface{}{"id": "id", "name": "name"}}, "rule_id": "rule_id", "trait_value": "trait_value", "updated_at": "2024-01-15T09:30:00Z"}}, "created_at": "2024-01-15T09:30:00Z", "environment_id": "environment_id", "id": "id", "rule_id": "rule_id", "updated_at": "2024-01-15T09:30:00Z"}}, "conditions": []interface{}{map[string]interface{}{"condition_type": "condition_type", "created_at": "2024-01-15T09:30:00Z", "environment_id": "environment_id", "id": "id", "operator": "operator", "resource_ids": []interface{}{"resource_ids"}, "resources": []interface{}{map[string]interface{}{"id": "id", "name": "name"}}, "rule_id": "rule_id", "trait_value": "trait_value", "updated_at": "2024-01-15T09:30:00Z"}}, "created_at": "2024-01-15T09:30:00Z", "environment_id": "environment_id", "id": "id", "name": "name", "priority": 1, "rule_type": "rule_type", "updated_at": "2024-01-15T09:30:00Z", "value": true}}, "updated_at": "2024-01-15T09:30:00Z"}}, "icon": "icon", "id": "id", "name": "name", "plans": []interface{}{map[string]interface{}{"id": "id", "name": "name"}}, "updated_at": "2024-01-15T09:30:00Z"}, "metric_reset_at": "2024-01-15T09:30:00Z", "month_reset": "month_reset", "period": "period", "plan": map[string]interface{}{"created_at": "2024-01-15T09:30:00Z", "description": "description", "icon": "icon", "id": "id", "name": "name", "plan_type": "plan_type", "updated_at": "2024-01-15T09:30:00Z"}, "usage": 1, "user": map[string]interface{}{"created_at": "2024-01-15T09:30:00Z", "environment_id": "environment_id", "id": "id", "name": "name", "updated_at": "2024-01-15T09:30:00Z"}}}, "params": map[string]interface{}{"feature_id": "feature_id", "limit": 1, "offset": 1, "q": "q"}},
		).WithStatus(http.StatusOK),
	)
	err := WireMockClient.StubFor(stub)
	require.NoError(t, err, "Failed to create WireMock stub")

	client := client.NewSchematicClient(
		option.WithBaseURL(
			WireMockBaseURL,
		),
	)
	request := &schematichq.ListFeatureUsersRequest{
		FeatureID: "feature_id",
		Q: schematichq.String(
			"q",
		),
		Limit: schematichq.Int(
			1,
		),
		Offset: schematichq.Int(
			1,
		),
	}
	_, invocationErr := client.Entitlements.ListFeatureUsers(
		context.TODO(),
		request,
	)

	require.NoError(t, invocationErr, "Client method call should succeed")
	ok, countErr := WireMockClient.Verify(stub.Request(), 1)
	require.NoError(t, countErr, "Failed to verify WireMock request was matched")
	require.True(t, ok, "WireMock request was not matched")
}

func TestEntitlementsCountFeatureUsersWithWireMock(
	t *testing.T,
) {
	// wiremock client and server initialized in shared main_test.go
	defer WireMockClient.Reset()
	stub := gowiremock.Get(gowiremock.URLPathTemplate("/feature-users/count")).WillReturnResponse(
		gowiremock.NewResponse().WithJSONBody(
			map[string]interface{}{"data": map[string]interface{}{"count": 1}, "params": map[string]interface{}{"feature_id": "feature_id", "limit": 1, "offset": 1, "q": "q"}},
		).WithStatus(http.StatusOK),
	)
	err := WireMockClient.StubFor(stub)
	require.NoError(t, err, "Failed to create WireMock stub")

	client := client.NewSchematicClient(
		option.WithBaseURL(
			WireMockBaseURL,
		),
	)
	request := &schematichq.CountFeatureUsersRequest{
		FeatureID: "feature_id",
		Q: schematichq.String(
			"q",
		),
		Limit: schematichq.Int(
			1,
		),
		Offset: schematichq.Int(
			1,
		),
	}
	_, invocationErr := client.Entitlements.CountFeatureUsers(
		context.TODO(),
		request,
	)

	require.NoError(t, invocationErr, "Client method call should succeed")
	ok, countErr := WireMockClient.Verify(stub.Request(), 1)
	require.NoError(t, countErr, "Failed to verify WireMock request was matched")
	require.True(t, ok, "WireMock request was not matched")
}

func TestEntitlementsListPlanEntitlementsWithWireMock(
	t *testing.T,
) {
	// wiremock client and server initialized in shared main_test.go
	defer WireMockClient.Reset()
	stub := gowiremock.Get(gowiremock.URLPathTemplate("/plan-entitlements")).WillReturnResponse(
		gowiremock.NewResponse().WithJSONBody(
			map[string]interface{}{"data": []interface{}{map[string]interface{}{"billing_threshold": 1, "consumption_rate": 1.1, "created_at": "2024-01-15T09:30:00Z", "environment_id": "environment_id", "feature": map[string]interface{}{"created_at": "2024-01-15T09:30:00Z", "description": "description", "feature_type": "feature_type", "icon": "icon", "id": "id", "name": "name", "updated_at": "2024-01-15T09:30:00Z"}, "feature_id": "feature_id", "id": "id", "metered_monthly_price": map[string]interface{}{"billing_scheme": "billing_scheme", "created_at": "2024-01-15T09:30:00Z", "currency": "currency", "id": "id", "interval": "interval", "is_active": true, "package_size": 1, "price": 1, "price_external_id": "price_external_id", "price_id": "price_id", "price_tier": []interface{}{map[string]interface{}{}}, "product_external_id": "product_external_id", "product_id": "product_id", "product_name": "product_name", "updated_at": "2024-01-15T09:30:00Z", "usage_type": "usage_type"}, "metered_yearly_price": map[string]interface{}{"billing_scheme": "billing_scheme", "created_at": "2024-01-15T09:30:00Z", "currency": "currency", "id": "id", "interval": "interval", "is_active": true, "package_size": 1, "price": 1, "price_external_id": "price_external_id", "price_id": "price_id", "price_tier": []interface{}{map[string]interface{}{}}, "product_external_id": "product_external_id", "product_id": "product_id", "product_name": "product_name", "updated_at": "2024-01-15T09:30:00Z", "usage_type": "usage_type"}, "metric_period": "metric_period", "metric_period_month_reset": "metric_period_month_reset", "plan": map[string]interface{}{"created_at": "2024-01-15T09:30:00Z", "description": "description", "icon": "icon", "id": "id", "name": "name", "plan_type": "plan_type", "updated_at": "2024-01-15T09:30:00Z"}, "plan_id": "plan_id", "price_behavior": "price_behavior", "rule_id": "rule_id", "rule_id_usage_exceeded": "rule_id_usage_exceeded", "soft_limit": 1, "updated_at": "2024-01-15T09:30:00Z", "usage_based_product": map[string]interface{}{"account_id": "account_id", "created_at": "2024-01-15T09:30:00Z", "environment_id": "environment_id", "external_id": "external_id", "is_active": true, "name": "name", "price": 1.1, "product_id": "product_id", "quantity": 1.1, "updated_at": "2024-01-15T09:30:00Z"}, "value_bool": true, "value_credit": map[string]interface{}{"burn_strategy": "burn_strategy", "created_at": "2024-01-15T09:30:00Z", "default_expiry_unit": "default_expiry_unit", "default_rollover_policy": "default_rollover_policy", "description": "description", "id": "id", "name": "name", "updated_at": "2024-01-15T09:30:00Z"}, "value_numeric": 1, "value_trait": map[string]interface{}{"created_at": "2024-01-15T09:30:00Z", "display_name": "display_name", "entity_type": "entity_type", "hierarchy": []interface{}{"hierarchy"}, "id": "id", "trait_type": "trait_type", "updated_at": "2024-01-15T09:30:00Z"}, "value_trait_id": "value_trait_id", "value_type": "value_type"}}, "params": map[string]interface{}{"feature_id": "feature_id", "feature_ids": []interface{}{"feature_ids"}, "ids": []interface{}{"ids"}, "limit": 1, "offset": 1, "plan_id": "plan_id", "plan_ids": []interface{}{"plan_ids"}, "q": "q", "with_metered_products": true}},
		).WithStatus(http.StatusOK),
	)
	err := WireMockClient.StubFor(stub)
	require.NoError(t, err, "Failed to create WireMock stub")

	client := client.NewSchematicClient(
		option.WithBaseURL(
			WireMockBaseURL,
		),
	)
	request := &schematichq.ListPlanEntitlementsRequest{
		FeatureID: schematichq.String(
			"feature_id",
		),
		PlanID: schematichq.String(
			"plan_id",
		),
		Q: schematichq.String(
			"q",
		),
		WithMeteredProducts: schematichq.Bool(
			true,
		),
		Limit: schematichq.Int(
			1,
		),
		Offset: schematichq.Int(
			1,
		),
	}
	_, invocationErr := client.Entitlements.ListPlanEntitlements(
		context.TODO(),
		request,
	)

	require.NoError(t, invocationErr, "Client method call should succeed")
	ok, countErr := WireMockClient.Verify(stub.Request(), 1)
	require.NoError(t, countErr, "Failed to verify WireMock request was matched")
	require.True(t, ok, "WireMock request was not matched")
}

func TestEntitlementsCreatePlanEntitlementWithWireMock(
	t *testing.T,
) {
	// wiremock client and server initialized in shared main_test.go
	defer WireMockClient.Reset()
	stub := gowiremock.Post(gowiremock.URLPathTemplate("/plan-entitlements")).WithBodyPattern(gowiremock.MatchesJsonSchema(`{
                    "$schema": "https://json-schema.org/draft/2020-12/schema",
                    "type": "object",
                    "required": ["feature_id", "plan_id", "value_type"],
                    "properties": {
                        "feature_id": {"type": "string"}, "plan_id": {"type": "string"}, "value_type": {"type": "string"}
                    },
                    "additionalProperties": true
                }`, "V202012")).WillReturnResponse(
		gowiremock.NewResponse().WithJSONBody(
			map[string]interface{}{"data": map[string]interface{}{"billing_threshold": 1, "consumption_rate": 1.1, "created_at": "2024-01-15T09:30:00Z", "environment_id": "environment_id", "feature": map[string]interface{}{"created_at": "2024-01-15T09:30:00Z", "description": "description", "event_subtype": "event_subtype", "feature_type": "feature_type", "icon": "icon", "id": "id", "lifecycle_phase": "lifecycle_phase", "maintainer_id": "maintainer_id", "name": "name", "plural_name": "plural_name", "singular_name": "singular_name", "trait_id": "trait_id", "updated_at": "2024-01-15T09:30:00Z"}, "feature_id": "feature_id", "id": "id", "metered_monthly_price": map[string]interface{}{"billing_scheme": "billing_scheme", "created_at": "2024-01-15T09:30:00Z", "currency": "currency", "id": "id", "interval": "interval", "is_active": true, "meter_event_name": "meter_event_name", "meter_event_payload_key": "meter_event_payload_key", "meter_id": "meter_id", "package_size": 1, "price": 1, "price_decimal": "price_decimal", "price_external_id": "price_external_id", "price_id": "price_id", "price_tier": []interface{}{map[string]interface{}{}}, "product_external_id": "product_external_id", "product_id": "product_id", "product_name": "product_name", "tiers_mode": "tiers_mode", "updated_at": "2024-01-15T09:30:00Z", "usage_type": "usage_type"}, "metered_yearly_price": map[string]interface{}{"billing_scheme": "billing_scheme", "created_at": "2024-01-15T09:30:00Z", "currency": "currency", "id": "id", "interval": "interval", "is_active": true, "meter_event_name": "meter_event_name", "meter_event_payload_key": "meter_event_payload_key", "meter_id": "meter_id", "package_size": 1, "price": 1, "price_decimal": "price_decimal", "price_external_id": "price_external_id", "price_id": "price_id", "price_tier": []interface{}{map[string]interface{}{}}, "product_external_id": "product_external_id", "product_id": "product_id", "product_name": "product_name", "tiers_mode": "tiers_mode", "updated_at": "2024-01-15T09:30:00Z", "usage_type": "usage_type"}, "metric_period": "metric_period", "metric_period_month_reset": "metric_period_month_reset", "plan": map[string]interface{}{"created_at": "2024-01-15T09:30:00Z", "description": "description", "icon": "icon", "id": "id", "name": "name", "plan_type": "plan_type", "updated_at": "2024-01-15T09:30:00Z"}, "plan_id": "plan_id", "price_behavior": "price_behavior", "rule_id": "rule_id", "rule_id_usage_exceeded": "rule_id_usage_exceeded", "soft_limit": 1, "updated_at": "2024-01-15T09:30:00Z", "usage_based_product": map[string]interface{}{"account_id": "account_id", "created_at": "2024-01-15T09:30:00Z", "environment_id": "environment_id", "external_id": "external_id", "is_active": true, "name": "name", "price": 1.1, "price_decimal": "price_decimal", "product_id": "product_id", "quantity": 1.1, "updated_at": "2024-01-15T09:30:00Z"}, "value_bool": true, "value_credit": map[string]interface{}{"burn_strategy": "burn_strategy", "created_at": "2024-01-15T09:30:00Z", "default_expiry_unit": "default_expiry_unit", "default_expiry_unit_count": 1, "default_rollover_policy": "default_rollover_policy", "description": "description", "icon": "icon", "id": "id", "name": "name", "plural_name": "plural_name", "price": map[string]interface{}{"currency": "currency", "external_price_id": "external_price_id", "id": "id", "interval": "interval", "price": 1, "scheme": "scheme"}, "product": map[string]interface{}{"account_id": "account_id", "created_at": "2024-01-15T09:30:00Z", "environment_id": "environment_id", "external_id": "external_id", "is_active": true, "name": "name", "price": 1.1, "product_id": "product_id", "quantity": 1.1, "updated_at": "2024-01-15T09:30:00Z"}, "singular_name": "singular_name", "updated_at": "2024-01-15T09:30:00Z"}, "value_numeric": 1, "value_trait": map[string]interface{}{"created_at": "2024-01-15T09:30:00Z", "display_name": "display_name", "entity_type": "entity_type", "hierarchy": []interface{}{"hierarchy"}, "id": "id", "trait_type": "trait_type", "updated_at": "2024-01-15T09:30:00Z"}, "value_trait_id": "value_trait_id", "value_type": "value_type"}, "params": map[string]interface{}{"key": "value"}},
		).WithStatus(http.StatusOK),
	)
	err := WireMockClient.StubFor(stub)
	require.NoError(t, err, "Failed to create WireMock stub")

	client := client.NewSchematicClient(
		option.WithBaseURL(
			WireMockBaseURL,
		),
	)
	request := &schematichq.CreatePlanEntitlementRequestBody{
		FeatureID: "feature_id",
		PlanID:    "plan_id",
		ValueType: schematichq.CreatePlanEntitlementRequestBodyValueTypeBoolean,
	}
	_, invocationErr := client.Entitlements.CreatePlanEntitlement(
		context.TODO(),
		request,
	)

	require.NoError(t, invocationErr, "Client method call should succeed")
	ok, countErr := WireMockClient.Verify(stub.Request(), 1)
	require.NoError(t, countErr, "Failed to verify WireMock request was matched")
	require.True(t, ok, "WireMock request was not matched")
}

func TestEntitlementsGetPlanEntitlementWithWireMock(
	t *testing.T,
) {
	// wiremock client and server initialized in shared main_test.go
	defer WireMockClient.Reset()
	stub := gowiremock.Get(gowiremock.URLPathTemplate("/plan-entitlements/{plan_entitlement_id}")).WithPathParam(
		"plan_entitlement_id",
		gowiremock.Matching("plan_entitlement_id"),
	).WillReturnResponse(
		gowiremock.NewResponse().WithJSONBody(
			map[string]interface{}{"data": map[string]interface{}{"billing_threshold": 1, "consumption_rate": 1.1, "created_at": "2024-01-15T09:30:00Z", "environment_id": "environment_id", "feature": map[string]interface{}{"created_at": "2024-01-15T09:30:00Z", "description": "description", "event_subtype": "event_subtype", "feature_type": "feature_type", "icon": "icon", "id": "id", "lifecycle_phase": "lifecycle_phase", "maintainer_id": "maintainer_id", "name": "name", "plural_name": "plural_name", "singular_name": "singular_name", "trait_id": "trait_id", "updated_at": "2024-01-15T09:30:00Z"}, "feature_id": "feature_id", "id": "id", "metered_monthly_price": map[string]interface{}{"billing_scheme": "billing_scheme", "created_at": "2024-01-15T09:30:00Z", "currency": "currency", "id": "id", "interval": "interval", "is_active": true, "meter_event_name": "meter_event_name", "meter_event_payload_key": "meter_event_payload_key", "meter_id": "meter_id", "package_size": 1, "price": 1, "price_decimal": "price_decimal", "price_external_id": "price_external_id", "price_id": "price_id", "price_tier": []interface{}{map[string]interface{}{}}, "product_external_id": "product_external_id", "product_id": "product_id", "product_name": "product_name", "tiers_mode": "tiers_mode", "updated_at": "2024-01-15T09:30:00Z", "usage_type": "usage_type"}, "metered_yearly_price": map[string]interface{}{"billing_scheme": "billing_scheme", "created_at": "2024-01-15T09:30:00Z", "currency": "currency", "id": "id", "interval": "interval", "is_active": true, "meter_event_name": "meter_event_name", "meter_event_payload_key": "meter_event_payload_key", "meter_id": "meter_id", "package_size": 1, "price": 1, "price_decimal": "price_decimal", "price_external_id": "price_external_id", "price_id": "price_id", "price_tier": []interface{}{map[string]interface{}{}}, "product_external_id": "product_external_id", "product_id": "product_id", "product_name": "product_name", "tiers_mode": "tiers_mode", "updated_at": "2024-01-15T09:30:00Z", "usage_type": "usage_type"}, "metric_period": "metric_period", "metric_period_month_reset": "metric_period_month_reset", "plan": map[string]interface{}{"created_at": "2024-01-15T09:30:00Z", "description": "description", "icon": "icon", "id": "id", "name": "name", "plan_type": "plan_type", "updated_at": "2024-01-15T09:30:00Z"}, "plan_id": "plan_id", "price_behavior": "price_behavior", "rule_id": "rule_id", "rule_id_usage_exceeded": "rule_id_usage_exceeded", "soft_limit": 1, "updated_at": "2024-01-15T09:30:00Z", "usage_based_product": map[string]interface{}{"account_id": "account_id", "created_at": "2024-01-15T09:30:00Z", "environment_id": "environment_id", "external_id": "external_id", "is_active": true, "name": "name", "price": 1.1, "price_decimal": "price_decimal", "product_id": "product_id", "quantity": 1.1, "updated_at": "2024-01-15T09:30:00Z"}, "value_bool": true, "value_credit": map[string]interface{}{"burn_strategy": "burn_strategy", "created_at": "2024-01-15T09:30:00Z", "default_expiry_unit": "default_expiry_unit", "default_expiry_unit_count": 1, "default_rollover_policy": "default_rollover_policy", "description": "description", "icon": "icon", "id": "id", "name": "name", "plural_name": "plural_name", "price": map[string]interface{}{"currency": "currency", "external_price_id": "external_price_id", "id": "id", "interval": "interval", "price": 1, "scheme": "scheme"}, "product": map[string]interface{}{"account_id": "account_id", "created_at": "2024-01-15T09:30:00Z", "environment_id": "environment_id", "external_id": "external_id", "is_active": true, "name": "name", "price": 1.1, "product_id": "product_id", "quantity": 1.1, "updated_at": "2024-01-15T09:30:00Z"}, "singular_name": "singular_name", "updated_at": "2024-01-15T09:30:00Z"}, "value_numeric": 1, "value_trait": map[string]interface{}{"created_at": "2024-01-15T09:30:00Z", "display_name": "display_name", "entity_type": "entity_type", "hierarchy": []interface{}{"hierarchy"}, "id": "id", "trait_type": "trait_type", "updated_at": "2024-01-15T09:30:00Z"}, "value_trait_id": "value_trait_id", "value_type": "value_type"}, "params": map[string]interface{}{"key": "value"}},
		).WithStatus(http.StatusOK),
	)
	err := WireMockClient.StubFor(stub)
	require.NoError(t, err, "Failed to create WireMock stub")

	client := client.NewSchematicClient(
		option.WithBaseURL(
			WireMockBaseURL,
		),
	)
	_, invocationErr := client.Entitlements.GetPlanEntitlement(
		context.TODO(),
		"plan_entitlement_id",
	)

	require.NoError(t, invocationErr, "Client method call should succeed")
	ok, countErr := WireMockClient.Verify(stub.Request(), 1)
	require.NoError(t, countErr, "Failed to verify WireMock request was matched")
	require.True(t, ok, "WireMock request was not matched")
}

func TestEntitlementsUpdatePlanEntitlementWithWireMock(
	t *testing.T,
) {
	// wiremock client and server initialized in shared main_test.go
	defer WireMockClient.Reset()
	stub := gowiremock.Put(gowiremock.URLPathTemplate("/plan-entitlements/{plan_entitlement_id}")).WithPathParam(
		"plan_entitlement_id",
		gowiremock.Matching("plan_entitlement_id"),
	).WithBodyPattern(gowiremock.MatchesJsonSchema(`{
                    "$schema": "https://json-schema.org/draft/2020-12/schema",
                    "type": "object",
                    "required": ["value_type"],
                    "properties": {
                        "value_type": {"type": "string"}
                    },
                    "additionalProperties": true
                }`, "V202012")).WillReturnResponse(
		gowiremock.NewResponse().WithJSONBody(
			map[string]interface{}{"data": map[string]interface{}{"billing_threshold": 1, "consumption_rate": 1.1, "created_at": "2024-01-15T09:30:00Z", "environment_id": "environment_id", "feature": map[string]interface{}{"created_at": "2024-01-15T09:30:00Z", "description": "description", "event_subtype": "event_subtype", "feature_type": "feature_type", "icon": "icon", "id": "id", "lifecycle_phase": "lifecycle_phase", "maintainer_id": "maintainer_id", "name": "name", "plural_name": "plural_name", "singular_name": "singular_name", "trait_id": "trait_id", "updated_at": "2024-01-15T09:30:00Z"}, "feature_id": "feature_id", "id": "id", "metered_monthly_price": map[string]interface{}{"billing_scheme": "billing_scheme", "created_at": "2024-01-15T09:30:00Z", "currency": "currency", "id": "id", "interval": "interval", "is_active": true, "meter_event_name": "meter_event_name", "meter_event_payload_key": "meter_event_payload_key", "meter_id": "meter_id", "package_size": 1, "price": 1, "price_decimal": "price_decimal", "price_external_id": "price_external_id", "price_id": "price_id", "price_tier": []interface{}{map[string]interface{}{}}, "product_external_id": "product_external_id", "product_id": "product_id", "product_name": "product_name", "tiers_mode": "tiers_mode", "updated_at": "2024-01-15T09:30:00Z", "usage_type": "usage_type"}, "metered_yearly_price": map[string]interface{}{"billing_scheme": "billing_scheme", "created_at": "2024-01-15T09:30:00Z", "currency": "currency", "id": "id", "interval": "interval", "is_active": true, "meter_event_name": "meter_event_name", "meter_event_payload_key": "meter_event_payload_key", "meter_id": "meter_id", "package_size": 1, "price": 1, "price_decimal": "price_decimal", "price_external_id": "price_external_id", "price_id": "price_id", "price_tier": []interface{}{map[string]interface{}{}}, "product_external_id": "product_external_id", "product_id": "product_id", "product_name": "product_name", "tiers_mode": "tiers_mode", "updated_at": "2024-01-15T09:30:00Z", "usage_type": "usage_type"}, "metric_period": "metric_period", "metric_period_month_reset": "metric_period_month_reset", "plan": map[string]interface{}{"created_at": "2024-01-15T09:30:00Z", "description": "description", "icon": "icon", "id": "id", "name": "name", "plan_type": "plan_type", "updated_at": "2024-01-15T09:30:00Z"}, "plan_id": "plan_id", "price_behavior": "price_behavior", "rule_id": "rule_id", "rule_id_usage_exceeded": "rule_id_usage_exceeded", "soft_limit": 1, "updated_at": "2024-01-15T09:30:00Z", "usage_based_product": map[string]interface{}{"account_id": "account_id", "created_at": "2024-01-15T09:30:00Z", "environment_id": "environment_id", "external_id": "external_id", "is_active": true, "name": "name", "price": 1.1, "price_decimal": "price_decimal", "product_id": "product_id", "quantity": 1.1, "updated_at": "2024-01-15T09:30:00Z"}, "value_bool": true, "value_credit": map[string]interface{}{"burn_strategy": "burn_strategy", "created_at": "2024-01-15T09:30:00Z", "default_expiry_unit": "default_expiry_unit", "default_expiry_unit_count": 1, "default_rollover_policy": "default_rollover_policy", "description": "description", "icon": "icon", "id": "id", "name": "name", "plural_name": "plural_name", "price": map[string]interface{}{"currency": "currency", "external_price_id": "external_price_id", "id": "id", "interval": "interval", "price": 1, "scheme": "scheme"}, "product": map[string]interface{}{"account_id": "account_id", "created_at": "2024-01-15T09:30:00Z", "environment_id": "environment_id", "external_id": "external_id", "is_active": true, "name": "name", "price": 1.1, "product_id": "product_id", "quantity": 1.1, "updated_at": "2024-01-15T09:30:00Z"}, "singular_name": "singular_name", "updated_at": "2024-01-15T09:30:00Z"}, "value_numeric": 1, "value_trait": map[string]interface{}{"created_at": "2024-01-15T09:30:00Z", "display_name": "display_name", "entity_type": "entity_type", "hierarchy": []interface{}{"hierarchy"}, "id": "id", "trait_type": "trait_type", "updated_at": "2024-01-15T09:30:00Z"}, "value_trait_id": "value_trait_id", "value_type": "value_type"}, "params": map[string]interface{}{"key": "value"}},
		).WithStatus(http.StatusOK),
	)
	err := WireMockClient.StubFor(stub)
	require.NoError(t, err, "Failed to create WireMock stub")

	client := client.NewSchematicClient(
		option.WithBaseURL(
			WireMockBaseURL,
		),
	)
	request := &schematichq.UpdatePlanEntitlementRequestBody{
		ValueType: schematichq.UpdatePlanEntitlementRequestBodyValueTypeBoolean,
	}
	_, invocationErr := client.Entitlements.UpdatePlanEntitlement(
		context.TODO(),
		"plan_entitlement_id",
		request,
	)

	require.NoError(t, invocationErr, "Client method call should succeed")
	ok, countErr := WireMockClient.Verify(stub.Request(), 1)
	require.NoError(t, countErr, "Failed to verify WireMock request was matched")
	require.True(t, ok, "WireMock request was not matched")
}

func TestEntitlementsDeletePlanEntitlementWithWireMock(
	t *testing.T,
) {
	// wiremock client and server initialized in shared main_test.go
	defer WireMockClient.Reset()
	stub := gowiremock.Delete(gowiremock.URLPathTemplate("/plan-entitlements/{plan_entitlement_id}")).WithPathParam(
		"plan_entitlement_id",
		gowiremock.Matching("plan_entitlement_id"),
	).WillReturnResponse(
		gowiremock.NewResponse().WithJSONBody(
			map[string]interface{}{"data": map[string]interface{}{"deleted": true}, "params": map[string]interface{}{"key": "value"}},
		).WithStatus(http.StatusOK),
	)
	err := WireMockClient.StubFor(stub)
	require.NoError(t, err, "Failed to create WireMock stub")

	client := client.NewSchematicClient(
		option.WithBaseURL(
			WireMockBaseURL,
		),
	)
	_, invocationErr := client.Entitlements.DeletePlanEntitlement(
		context.TODO(),
		"plan_entitlement_id",
	)

	require.NoError(t, invocationErr, "Client method call should succeed")
	ok, countErr := WireMockClient.Verify(stub.Request(), 1)
	require.NoError(t, countErr, "Failed to verify WireMock request was matched")
	require.True(t, ok, "WireMock request was not matched")
}

func TestEntitlementsCountPlanEntitlementsWithWireMock(
	t *testing.T,
) {
	// wiremock client and server initialized in shared main_test.go
	defer WireMockClient.Reset()
	stub := gowiremock.Get(gowiremock.URLPathTemplate("/plan-entitlements/count")).WillReturnResponse(
		gowiremock.NewResponse().WithJSONBody(
			map[string]interface{}{"data": map[string]interface{}{"count": 1}, "params": map[string]interface{}{"feature_id": "feature_id", "feature_ids": []interface{}{"feature_ids"}, "ids": []interface{}{"ids"}, "limit": 1, "offset": 1, "plan_id": "plan_id", "plan_ids": []interface{}{"plan_ids"}, "q": "q", "with_metered_products": true}},
		).WithStatus(http.StatusOK),
	)
	err := WireMockClient.StubFor(stub)
	require.NoError(t, err, "Failed to create WireMock stub")

	client := client.NewSchematicClient(
		option.WithBaseURL(
			WireMockBaseURL,
		),
	)
	request := &schematichq.CountPlanEntitlementsRequest{
		FeatureID: schematichq.String(
			"feature_id",
		),
		PlanID: schematichq.String(
			"plan_id",
		),
		Q: schematichq.String(
			"q",
		),
		WithMeteredProducts: schematichq.Bool(
			true,
		),
		Limit: schematichq.Int(
			1,
		),
		Offset: schematichq.Int(
			1,
		),
	}
	_, invocationErr := client.Entitlements.CountPlanEntitlements(
		context.TODO(),
		request,
	)

	require.NoError(t, invocationErr, "Client method call should succeed")
	ok, countErr := WireMockClient.Verify(stub.Request(), 1)
	require.NoError(t, countErr, "Failed to verify WireMock request was matched")
	require.True(t, ok, "WireMock request was not matched")
}

func TestEntitlementsGetFeatureUsageByCompanyWithWireMock(
	t *testing.T,
) {
	// wiremock client and server initialized in shared main_test.go
	defer WireMockClient.Reset()
	stub := gowiremock.Get(gowiremock.URLPathTemplate("/usage-by-company")).WillReturnResponse(
		gowiremock.NewResponse().WithJSONBody(
			map[string]interface{}{"data": map[string]interface{}{"features": []interface{}{map[string]interface{}{"access": true, "allocation": 1, "allocation_type": "boolean", "company_override": map[string]interface{}{"company": map[string]interface{}{"add_ons": []interface{}{map[string]interface{}{"id": "id", "name": "name"}, map[string]interface{}{"id": "id", "name": "name"}}, "billing_credit_balances": map[string]interface{}{"billing_credit_balances": 1.1}, "billing_subscription": map[string]interface{}{"cancel_at_period_end": true, "created_at": "2024-01-15T09:30:00Z", "currency": "currency", "customer_external_id": "customer_external_id", "discounts": []interface{}{}, "id": "id", "interval": "interval", "period_end": 1, "period_start": 1, "products": []interface{}{}, "status": "status", "subscription_external_id": "subscription_external_id", "total_price": 1}, "billing_subscriptions": []interface{}{map[string]interface{}{"cancel_at_period_end": true, "created_at": "2024-01-15T09:30:00Z", "currency": "currency", "customer_external_id": "customer_external_id", "discounts": []interface{}{}, "id": "id", "interval": "interval", "period_end": 1, "period_start": 1, "products": []interface{}{}, "status": "status", "subscription_external_id": "subscription_external_id", "total_price": 1}, map[string]interface{}{"cancel_at_period_end": true, "created_at": "2024-01-15T09:30:00Z", "currency": "currency", "customer_external_id": "customer_external_id", "discounts": []interface{}{}, "id": "id", "interval": "interval", "period_end": 1, "period_start": 1, "products": []interface{}{}, "status": "status", "subscription_external_id": "subscription_external_id", "total_price": 1}}, "created_at": "2024-01-15T09:30:00Z", "default_payment_method": map[string]interface{}{"created_at": "2024-01-15T09:30:00Z", "customer_external_id": "customer_external_id", "environment_id": "environment_id", "external_id": "external_id", "id": "id", "payment_method_type": "payment_method_type", "updated_at": "2024-01-15T09:30:00Z"}, "entity_traits": []interface{}{map[string]interface{}{"created_at": "2024-01-15T09:30:00Z", "definition_id": "definition_id", "environment_id": "environment_id", "id": "id", "updated_at": "2024-01-15T09:30:00Z", "value": "value"}, map[string]interface{}{"created_at": "2024-01-15T09:30:00Z", "definition_id": "definition_id", "environment_id": "environment_id", "id": "id", "updated_at": "2024-01-15T09:30:00Z", "value": "value"}}, "environment_id": "environment_id", "id": "id", "keys": []interface{}{map[string]interface{}{"created_at": "2024-01-15T09:30:00Z", "definition_id": "definition_id", "entity_id": "entity_id", "entity_type": "entity_type", "environment_id": "environment_id", "id": "id", "key": "key", "updated_at": "2024-01-15T09:30:00Z", "value": "value"}, map[string]interface{}{"created_at": "2024-01-15T09:30:00Z", "definition_id": "definition_id", "entity_id": "entity_id", "entity_type": "entity_type", "environment_id": "environment_id", "id": "id", "key": "key", "updated_at": "2024-01-15T09:30:00Z", "value": "value"}}, "last_seen_at": "2024-01-15T09:30:00Z", "logo_url": "logo_url", "metrics": []interface{}{map[string]interface{}{"account_id": "account_id", "captured_at_max": "2024-01-15T09:30:00Z", "captured_at_min": "2024-01-15T09:30:00Z", "company_id": "company_id", "created_at": "2024-01-15T09:30:00Z", "environment_id": "environment_id", "event_subtype": "event_subtype", "month_reset": "month_reset", "period": "period", "value": 1}, map[string]interface{}{"account_id": "account_id", "captured_at_max": "2024-01-15T09:30:00Z", "captured_at_min": "2024-01-15T09:30:00Z", "company_id": "company_id", "created_at": "2024-01-15T09:30:00Z", "environment_id": "environment_id", "event_subtype": "event_subtype", "month_reset": "month_reset", "period": "period", "value": 1}}, "name": "name", "payment_methods": []interface{}{map[string]interface{}{"created_at": "2024-01-15T09:30:00Z", "customer_external_id": "customer_external_id", "environment_id": "environment_id", "external_id": "external_id", "id": "id", "payment_method_type": "payment_method_type", "updated_at": "2024-01-15T09:30:00Z"}, map[string]interface{}{"created_at": "2024-01-15T09:30:00Z", "customer_external_id": "customer_external_id", "environment_id": "environment_id", "external_id": "external_id", "id": "id", "payment_method_type": "payment_method_type", "updated_at": "2024-01-15T09:30:00Z"}}, "plan": map[string]interface{}{"id": "id", "name": "name"}, "plans": []interface{}{map[string]interface{}{"id": "id", "name": "name"}, map[string]interface{}{"id": "id", "name": "name"}}, "rules": []interface{}{map[string]interface{}{"account_id": "account_id", "condition_groups": []interface{}{}, "conditions": []interface{}{}, "environment_id": "environment_id", "id": "id", "name": "name", "priority": 1, "rule_type": "default", "value": true}, map[string]interface{}{"account_id": "account_id", "condition_groups": []interface{}{}, "conditions": []interface{}{}, "environment_id": "environment_id", "id": "id", "name": "name", "priority": 1, "rule_type": "default", "value": true}}, "traits": map[string]interface{}{"traits": map[string]interface{}{"key": "value"}}, "updated_at": "2024-01-15T09:30:00Z", "user_count": 1}, "company_id": "company_id", "consumption_rate": 1.1, "created_at": "2024-01-15T09:30:00Z", "environment_id": "environment_id", "expiration_date": "2024-01-15T09:30:00Z", "feature": map[string]interface{}{"created_at": "2024-01-15T09:30:00Z", "description": "description", "event_subtype": "event_subtype", "feature_type": "feature_type", "icon": "icon", "id": "id", "lifecycle_phase": "lifecycle_phase", "maintainer_id": "maintainer_id", "name": "name", "plural_name": "plural_name", "singular_name": "singular_name", "trait_id": "trait_id", "updated_at": "2024-01-15T09:30:00Z"}, "feature_id": "feature_id", "id": "id", "metric_period": "metric_period", "metric_period_month_reset": "metric_period_month_reset", "notes": []interface{}{map[string]interface{}{"created_at": "2024-01-15T09:30:00Z", "external_user_id": "external_user_id", "external_user_name": "external_user_name", "id": "id", "note": "note", "updated_at": "2024-01-15T09:30:00Z"}, map[string]interface{}{"created_at": "2024-01-15T09:30:00Z", "external_user_id": "external_user_id", "external_user_name": "external_user_name", "id": "id", "note": "note", "updated_at": "2024-01-15T09:30:00Z"}}, "rule_id": "rule_id", "rule_id_usage_exceeded": "rule_id_usage_exceeded", "updated_at": "2024-01-15T09:30:00Z", "value_bool": true, "value_numeric": 1, "value_trait": map[string]interface{}{"created_at": "2024-01-15T09:30:00Z", "display_name": "display_name", "entity_type": "entity_type", "hierarchy": []interface{}{"hierarchy", "hierarchy"}, "id": "id", "trait_type": "trait_type", "updated_at": "2024-01-15T09:30:00Z"}, "value_trait_id": "value_trait_id", "value_type": "value_type"}, "credit_consumption_rate": 1.1, "credit_grant_counts": map[string]interface{}{"credit_grant_counts": 1.1}, "credit_grant_details": []interface{}{map[string]interface{}{"credit_type_icon": "credit_type_icon", "expires_at": "2024-01-15T09:30:00Z", "grant_reason": "free", "quantity": 1.1}, map[string]interface{}{"credit_type_icon": "credit_type_icon", "expires_at": "2024-01-15T09:30:00Z", "grant_reason": "free", "quantity": 1.1}}, "credit_grant_reason": "free", "credit_remaining": 1.1, "credit_total": 1.1, "credit_type_icon": "credit_type_icon", "credit_used": 1.1, "effective_limit": 1, "effective_price": 1.1, "entitlement_expiration_date": "2024-01-15T09:30:00Z", "entitlement_id": "entitlement_id", "entitlement_source": "entitlement_source", "entitlement_type": "entitlement_type", "feature": map[string]interface{}{"created_at": "2024-01-15T09:30:00Z", "description": "description", "event_subtype": "event_subtype", "event_summary": map[string]interface{}{"company_count": 1, "environment_id": "environment_id", "event_count": 1, "event_subtype": "event_subtype", "last_seen_at": "2024-01-15T09:30:00Z", "user_count": 1}, "feature_type": "feature_type", "flags": []interface{}{map[string]interface{}{"created_at": "2024-01-15T09:30:00Z", "default_value": true, "description": "description", "feature": map[string]interface{}{"created_at": "2024-01-15T09:30:00Z", "description": "description", "feature_type": "feature_type", "icon": "icon", "id": "id", "name": "name", "updated_at": "2024-01-15T09:30:00Z"}, "feature_id": "feature_id", "flag_type": "flag_type", "id": "id", "key": "key", "last_checked_at": "2024-01-15T09:30:00Z", "maintainer_id": "maintainer_id", "name": "name", "rules": []interface{}{map[string]interface{}{"condition_groups": []interface{}{}, "conditions": []interface{}{}, "created_at": "2024-01-15T09:30:00Z", "environment_id": "environment_id", "id": "id", "name": "name", "priority": 1, "rule_type": "rule_type", "updated_at": "2024-01-15T09:30:00Z", "value": true}, map[string]interface{}{"condition_groups": []interface{}{}, "conditions": []interface{}{}, "created_at": "2024-01-15T09:30:00Z", "environment_id": "environment_id", "id": "id", "name": "name", "priority": 1, "rule_type": "rule_type", "updated_at": "2024-01-15T09:30:00Z", "value": true}}, "updated_at": "2024-01-15T09:30:00Z"}, map[string]interface{}{"created_at": "2024-01-15T09:30:00Z", "default_value": true, "description": "description", "feature": map[string]interface{}{"created_at": "2024-01-15T09:30:00Z", "description": "description", "feature_type": "feature_type", "icon": "icon", "id": "id", "name": "name", "updated_at": "2024-01-15T09:30:00Z"}, "feature_id": "feature_id", "flag_type": "flag_type", "id": "id", "key": "key", "last_checked_at": "2024-01-15T09:30:00Z", "maintainer_id": "maintainer_id", "name": "name", "rules": []interface{}{map[string]interface{}{"condition_groups": []interface{}{}, "conditions": []interface{}{}, "created_at": "2024-01-15T09:30:00Z", "environment_id": "environment_id", "id": "id", "name": "name", "priority": 1, "rule_type": "rule_type", "updated_at": "2024-01-15T09:30:00Z", "value": true}, map[string]interface{}{"condition_groups": []interface{}{}, "conditions": []interface{}{}, "created_at": "2024-01-15T09:30:00Z", "environment_id": "environment_id", "id": "id", "name": "name", "priority": 1, "rule_type": "rule_type", "updated_at": "2024-01-15T09:30:00Z", "value": true}}, "updated_at": "2024-01-15T09:30:00Z"}}, "icon": "icon", "id": "id", "lifecycle_phase": "lifecycle_phase", "maintainer_id": "maintainer_id", "name": "name", "plans": []interface{}{map[string]interface{}{"description": "description", "id": "id", "image_url": "image_url", "name": "name"}, map[string]interface{}{"description": "description", "id": "id", "image_url": "image_url", "name": "name"}}, "plural_name": "plural_name", "singular_name": "singular_name", "trait": map[string]interface{}{"created_at": "2024-01-15T09:30:00Z", "display_name": "display_name", "entity_type": "entity_type", "hierarchy": []interface{}{"hierarchy", "hierarchy"}, "id": "id", "trait_type": "trait_type", "updated_at": "2024-01-15T09:30:00Z"}, "trait_id": "trait_id", "updated_at": "2024-01-15T09:30:00Z"}, "has_valid_allocation": true, "is_unlimited": true, "metric_reset_at": "2024-01-15T09:30:00Z", "month_reset": "month_reset", "monthly_usage_based_price": map[string]interface{}{"billing_scheme": "billing_scheme", "created_at": "2024-01-15T09:30:00Z", "currency": "currency", "id": "id", "interval": "interval", "is_active": true, "meter_event_name": "meter_event_name", "meter_event_payload_key": "meter_event_payload_key", "meter_id": "meter_id", "package_size": 1, "price": 1, "price_decimal": "price_decimal", "price_external_id": "price_external_id", "price_id": "price_id", "price_tier": []interface{}{map[string]interface{}{"flat_amount": 1, "per_unit_price": 1, "per_unit_price_decimal": "per_unit_price_decimal", "up_to": 1}, map[string]interface{}{"flat_amount": 1, "per_unit_price": 1, "per_unit_price_decimal": "per_unit_price_decimal", "up_to": 1}}, "product_external_id": "product_external_id", "product_id": "product_id", "product_name": "product_name", "tiers_mode": "tiers_mode", "updated_at": "2024-01-15T09:30:00Z", "usage_type": "usage_type"}, "overuse": 1, "percent_used": 1.1, "period": "period", "plan": map[string]interface{}{"audience_type": "audience_type", "created_at": "2024-01-15T09:30:00Z", "description": "description", "icon": "icon", "id": "id", "name": "name", "plan_type": "plan_type", "updated_at": "2024-01-15T09:30:00Z"}, "plan_entitlement": map[string]interface{}{"billing_threshold": 1, "consumption_rate": 1.1, "created_at": "2024-01-15T09:30:00Z", "environment_id": "environment_id", "feature": map[string]interface{}{"created_at": "2024-01-15T09:30:00Z", "description": "description", "event_subtype": "event_subtype", "feature_type": "feature_type", "icon": "icon", "id": "id", "lifecycle_phase": "lifecycle_phase", "maintainer_id": "maintainer_id", "name": "name", "plural_name": "plural_name", "singular_name": "singular_name", "trait_id": "trait_id", "updated_at": "2024-01-15T09:30:00Z"}, "feature_id": "feature_id", "id": "id", "metered_monthly_price": map[string]interface{}{"billing_scheme": "billing_scheme", "created_at": "2024-01-15T09:30:00Z", "currency": "currency", "id": "id", "interval": "interval", "is_active": true, "meter_event_name": "meter_event_name", "meter_event_payload_key": "meter_event_payload_key", "meter_id": "meter_id", "package_size": 1, "price": 1, "price_decimal": "price_decimal", "price_external_id": "price_external_id", "price_id": "price_id", "price_tier": []interface{}{map[string]interface{}{}, map[string]interface{}{}}, "product_external_id": "product_external_id", "product_id": "product_id", "product_name": "product_name", "tiers_mode": "tiers_mode", "updated_at": "2024-01-15T09:30:00Z", "usage_type": "usage_type"}, "metered_yearly_price": map[string]interface{}{"billing_scheme": "billing_scheme", "created_at": "2024-01-15T09:30:00Z", "currency": "currency", "id": "id", "interval": "interval", "is_active": true, "meter_event_name": "meter_event_name", "meter_event_payload_key": "meter_event_payload_key", "meter_id": "meter_id", "package_size": 1, "price": 1, "price_decimal": "price_decimal", "price_external_id": "price_external_id", "price_id": "price_id", "price_tier": []interface{}{map[string]interface{}{}, map[string]interface{}{}}, "product_external_id": "product_external_id", "product_id": "product_id", "product_name": "product_name", "tiers_mode": "tiers_mode", "updated_at": "2024-01-15T09:30:00Z", "usage_type": "usage_type"}, "metric_period": "metric_period", "metric_period_month_reset": "metric_period_month_reset", "plan": map[string]interface{}{"audience_type": "audience_type", "created_at": "2024-01-15T09:30:00Z", "description": "description", "icon": "icon", "id": "id", "name": "name", "plan_type": "plan_type", "updated_at": "2024-01-15T09:30:00Z"}, "plan_id": "plan_id", "price_behavior": "price_behavior", "rule_id": "rule_id", "rule_id_usage_exceeded": "rule_id_usage_exceeded", "soft_limit": 1, "updated_at": "2024-01-15T09:30:00Z", "usage_based_product": map[string]interface{}{"account_id": "account_id", "created_at": "2024-01-15T09:30:00Z", "currency": "currency", "environment_id": "environment_id", "external_id": "external_id", "is_active": true, "name": "name", "price": 1.1, "price_decimal": "price_decimal", "product_id": "product_id", "quantity": 1.1, "updated_at": "2024-01-15T09:30:00Z"}, "value_bool": true, "value_credit": map[string]interface{}{"burn_strategy": "burn_strategy", "created_at": "2024-01-15T09:30:00Z", "default_expiry_unit": "default_expiry_unit", "default_expiry_unit_count": 1, "default_rollover_policy": "default_rollover_policy", "description": "description", "icon": "icon", "id": "id", "name": "name", "plural_name": "plural_name", "price": map[string]interface{}{"currency": "currency", "external_price_id": "external_price_id", "id": "id", "interval": "interval", "price": 1, "scheme": "scheme"}, "product": map[string]interface{}{"account_id": "account_id", "created_at": "2024-01-15T09:30:00Z", "environment_id": "environment_id", "external_id": "external_id", "is_active": true, "name": "name", "price": 1.1, "product_id": "product_id", "quantity": 1.1, "updated_at": "2024-01-15T09:30:00Z"}, "singular_name": "singular_name", "updated_at": "2024-01-15T09:30:00Z"}, "value_numeric": 1, "value_trait": map[string]interface{}{"created_at": "2024-01-15T09:30:00Z", "display_name": "display_name", "entity_type": "entity_type", "hierarchy": []interface{}{"hierarchy", "hierarchy"}, "id": "id", "trait_type": "trait_type", "updated_at": "2024-01-15T09:30:00Z"}, "value_trait_id": "value_trait_id", "value_type": "value_type"}, "price_behavior": "price_behavior", "soft_limit": 1, "usage": 1, "yearly_usage_based_price": map[string]interface{}{"billing_scheme": "billing_scheme", "created_at": "2024-01-15T09:30:00Z", "currency": "currency", "id": "id", "interval": "interval", "is_active": true, "meter_event_name": "meter_event_name", "meter_event_payload_key": "meter_event_payload_key", "meter_id": "meter_id", "package_size": 1, "price": 1, "price_decimal": "price_decimal", "price_external_id": "price_external_id", "price_id": "price_id", "price_tier": []interface{}{map[string]interface{}{"flat_amount": 1, "per_unit_price": 1, "per_unit_price_decimal": "per_unit_price_decimal", "up_to": 1}, map[string]interface{}{"flat_amount": 1, "per_unit_price": 1, "per_unit_price_decimal": "per_unit_price_decimal", "up_to": 1}}, "product_external_id": "product_external_id", "product_id": "product_id", "product_name": "product_name", "tiers_mode": "tiers_mode", "updated_at": "2024-01-15T09:30:00Z", "usage_type": "usage_type"}}, map[string]interface{}{"access": true, "allocation": 1, "allocation_type": "boolean", "company_override": map[string]interface{}{"company": map[string]interface{}{"add_ons": []interface{}{map[string]interface{}{"id": "id", "name": "name"}, map[string]interface{}{"id": "id", "name": "name"}}, "billing_credit_balances": map[string]interface{}{"billing_credit_balances": 1.1}, "billing_subscription": map[string]interface{}{"cancel_at_period_end": true, "created_at": "2024-01-15T09:30:00Z", "currency": "currency", "customer_external_id": "customer_external_id", "discounts": []interface{}{}, "id": "id", "interval": "interval", "period_end": 1, "period_start": 1, "products": []interface{}{}, "status": "status", "subscription_external_id": "subscription_external_id", "total_price": 1}, "billing_subscriptions": []interface{}{map[string]interface{}{"cancel_at_period_end": true, "created_at": "2024-01-15T09:30:00Z", "currency": "currency", "customer_external_id": "customer_external_id", "discounts": []interface{}{}, "id": "id", "interval": "interval", "period_end": 1, "period_start": 1, "products": []interface{}{}, "status": "status", "subscription_external_id": "subscription_external_id", "total_price": 1}, map[string]interface{}{"cancel_at_period_end": true, "created_at": "2024-01-15T09:30:00Z", "currency": "currency", "customer_external_id": "customer_external_id", "discounts": []interface{}{}, "id": "id", "interval": "interval", "period_end": 1, "period_start": 1, "products": []interface{}{}, "status": "status", "subscription_external_id": "subscription_external_id", "total_price": 1}}, "created_at": "2024-01-15T09:30:00Z", "default_payment_method": map[string]interface{}{"created_at": "2024-01-15T09:30:00Z", "customer_external_id": "customer_external_id", "environment_id": "environment_id", "external_id": "external_id", "id": "id", "payment_method_type": "payment_method_type", "updated_at": "2024-01-15T09:30:00Z"}, "entity_traits": []interface{}{map[string]interface{}{"created_at": "2024-01-15T09:30:00Z", "definition_id": "definition_id", "environment_id": "environment_id", "id": "id", "updated_at": "2024-01-15T09:30:00Z", "value": "value"}, map[string]interface{}{"created_at": "2024-01-15T09:30:00Z", "definition_id": "definition_id", "environment_id": "environment_id", "id": "id", "updated_at": "2024-01-15T09:30:00Z", "value": "value"}}, "environment_id": "environment_id", "id": "id", "keys": []interface{}{map[string]interface{}{"created_at": "2024-01-15T09:30:00Z", "definition_id": "definition_id", "entity_id": "entity_id", "entity_type": "entity_type", "environment_id": "environment_id", "id": "id", "key": "key", "updated_at": "2024-01-15T09:30:00Z", "value": "value"}, map[string]interface{}{"created_at": "2024-01-15T09:30:00Z", "definition_id": "definition_id", "entity_id": "entity_id", "entity_type": "entity_type", "environment_id": "environment_id", "id": "id", "key": "key", "updated_at": "2024-01-15T09:30:00Z", "value": "value"}}, "last_seen_at": "2024-01-15T09:30:00Z", "logo_url": "logo_url", "metrics": []interface{}{map[string]interface{}{"account_id": "account_id", "captured_at_max": "2024-01-15T09:30:00Z", "captured_at_min": "2024-01-15T09:30:00Z", "company_id": "company_id", "created_at": "2024-01-15T09:30:00Z", "environment_id": "environment_id", "event_subtype": "event_subtype", "month_reset": "month_reset", "period": "period", "value": 1}, map[string]interface{}{"account_id": "account_id", "captured_at_max": "2024-01-15T09:30:00Z", "captured_at_min": "2024-01-15T09:30:00Z", "company_id": "company_id", "created_at": "2024-01-15T09:30:00Z", "environment_id": "environment_id", "event_subtype": "event_subtype", "month_reset": "month_reset", "period": "period", "value": 1}}, "name": "name", "payment_methods": []interface{}{map[string]interface{}{"created_at": "2024-01-15T09:30:00Z", "customer_external_id": "customer_external_id", "environment_id": "environment_id", "external_id": "external_id", "id": "id", "payment_method_type": "payment_method_type", "updated_at": "2024-01-15T09:30:00Z"}, map[string]interface{}{"created_at": "2024-01-15T09:30:00Z", "customer_external_id": "customer_external_id", "environment_id": "environment_id", "external_id": "external_id", "id": "id", "payment_method_type": "payment_method_type", "updated_at": "2024-01-15T09:30:00Z"}}, "plan": map[string]interface{}{"id": "id", "name": "name"}, "plans": []interface{}{map[string]interface{}{"id": "id", "name": "name"}, map[string]interface{}{"id": "id", "name": "name"}}, "rules": []interface{}{map[string]interface{}{"account_id": "account_id", "condition_groups": []interface{}{}, "conditions": []interface{}{}, "environment_id": "environment_id", "id": "id", "name": "name", "priority": 1, "rule_type": "default", "value": true}, map[string]interface{}{"account_id": "account_id", "condition_groups": []interface{}{}, "conditions": []interface{}{}, "environment_id": "environment_id", "id": "id", "name": "name", "priority": 1, "rule_type": "default", "value": true}}, "traits": map[string]interface{}{"traits": map[string]interface{}{"key": "value"}}, "updated_at": "2024-01-15T09:30:00Z", "user_count": 1}, "company_id": "company_id", "consumption_rate": 1.1, "created_at": "2024-01-15T09:30:00Z", "environment_id": "environment_id", "expiration_date": "2024-01-15T09:30:00Z", "feature": map[string]interface{}{"created_at": "2024-01-15T09:30:00Z", "description": "description", "event_subtype": "event_subtype", "feature_type": "feature_type", "icon": "icon", "id": "id", "lifecycle_phase": "lifecycle_phase", "maintainer_id": "maintainer_id", "name": "name", "plural_name": "plural_name", "singular_name": "singular_name", "trait_id": "trait_id", "updated_at": "2024-01-15T09:30:00Z"}, "feature_id": "feature_id", "id": "id", "metric_period": "metric_period", "metric_period_month_reset": "metric_period_month_reset", "notes": []interface{}{map[string]interface{}{"created_at": "2024-01-15T09:30:00Z", "external_user_id": "external_user_id", "external_user_name": "external_user_name", "id": "id", "note": "note", "updated_at": "2024-01-15T09:30:00Z"}, map[string]interface{}{"created_at": "2024-01-15T09:30:00Z", "external_user_id": "external_user_id", "external_user_name": "external_user_name", "id": "id", "note": "note", "updated_at": "2024-01-15T09:30:00Z"}}, "rule_id": "rule_id", "rule_id_usage_exceeded": "rule_id_usage_exceeded", "updated_at": "2024-01-15T09:30:00Z", "value_bool": true, "value_numeric": 1, "value_trait": map[string]interface{}{"created_at": "2024-01-15T09:30:00Z", "display_name": "display_name", "entity_type": "entity_type", "hierarchy": []interface{}{"hierarchy", "hierarchy"}, "id": "id", "trait_type": "trait_type", "updated_at": "2024-01-15T09:30:00Z"}, "value_trait_id": "value_trait_id", "value_type": "value_type"}, "credit_consumption_rate": 1.1, "credit_grant_counts": map[string]interface{}{"credit_grant_counts": 1.1}, "credit_grant_details": []interface{}{map[string]interface{}{"credit_type_icon": "credit_type_icon", "expires_at": "2024-01-15T09:30:00Z", "grant_reason": "free", "quantity": 1.1}, map[string]interface{}{"credit_type_icon": "credit_type_icon", "expires_at": "2024-01-15T09:30:00Z", "grant_reason": "free", "quantity": 1.1}}, "credit_grant_reason": "free", "credit_remaining": 1.1, "credit_total": 1.1, "credit_type_icon": "credit_type_icon", "credit_used": 1.1, "effective_limit": 1, "effective_price": 1.1, "entitlement_expiration_date": "2024-01-15T09:30:00Z", "entitlement_id": "entitlement_id", "entitlement_source": "entitlement_source", "entitlement_type": "entitlement_type", "feature": map[string]interface{}{"created_at": "2024-01-15T09:30:00Z", "description": "description", "event_subtype": "event_subtype", "event_summary": map[string]interface{}{"company_count": 1, "environment_id": "environment_id", "event_count": 1, "event_subtype": "event_subtype", "last_seen_at": "2024-01-15T09:30:00Z", "user_count": 1}, "feature_type": "feature_type", "flags": []interface{}{map[string]interface{}{"created_at": "2024-01-15T09:30:00Z", "default_value": true, "description": "description", "feature": map[string]interface{}{"created_at": "2024-01-15T09:30:00Z", "description": "description", "feature_type": "feature_type", "icon": "icon", "id": "id", "name": "name", "updated_at": "2024-01-15T09:30:00Z"}, "feature_id": "feature_id", "flag_type": "flag_type", "id": "id", "key": "key", "last_checked_at": "2024-01-15T09:30:00Z", "maintainer_id": "maintainer_id", "name": "name", "rules": []interface{}{map[string]interface{}{"condition_groups": []interface{}{}, "conditions": []interface{}{}, "created_at": "2024-01-15T09:30:00Z", "environment_id": "environment_id", "id": "id", "name": "name", "priority": 1, "rule_type": "rule_type", "updated_at": "2024-01-15T09:30:00Z", "value": true}, map[string]interface{}{"condition_groups": []interface{}{}, "conditions": []interface{}{}, "created_at": "2024-01-15T09:30:00Z", "environment_id": "environment_id", "id": "id", "name": "name", "priority": 1, "rule_type": "rule_type", "updated_at": "2024-01-15T09:30:00Z", "value": true}}, "updated_at": "2024-01-15T09:30:00Z"}, map[string]interface{}{"created_at": "2024-01-15T09:30:00Z", "default_value": true, "description": "description", "feature": map[string]interface{}{"created_at": "2024-01-15T09:30:00Z", "description": "description", "feature_type": "feature_type", "icon": "icon", "id": "id", "name": "name", "updated_at": "2024-01-15T09:30:00Z"}, "feature_id": "feature_id", "flag_type": "flag_type", "id": "id", "key": "key", "last_checked_at": "2024-01-15T09:30:00Z", "maintainer_id": "maintainer_id", "name": "name", "rules": []interface{}{map[string]interface{}{"condition_groups": []interface{}{}, "conditions": []interface{}{}, "created_at": "2024-01-15T09:30:00Z", "environment_id": "environment_id", "id": "id", "name": "name", "priority": 1, "rule_type": "rule_type", "updated_at": "2024-01-15T09:30:00Z", "value": true}, map[string]interface{}{"condition_groups": []interface{}{}, "conditions": []interface{}{}, "created_at": "2024-01-15T09:30:00Z", "environment_id": "environment_id", "id": "id", "name": "name", "priority": 1, "rule_type": "rule_type", "updated_at": "2024-01-15T09:30:00Z", "value": true}}, "updated_at": "2024-01-15T09:30:00Z"}}, "icon": "icon", "id": "id", "lifecycle_phase": "lifecycle_phase", "maintainer_id": "maintainer_id", "name": "name", "plans": []interface{}{map[string]interface{}{"description": "description", "id": "id", "image_url": "image_url", "name": "name"}, map[string]interface{}{"description": "description", "id": "id", "image_url": "image_url", "name": "name"}}, "plural_name": "plural_name", "singular_name": "singular_name", "trait": map[string]interface{}{"created_at": "2024-01-15T09:30:00Z", "display_name": "display_name", "entity_type": "entity_type", "hierarchy": []interface{}{"hierarchy", "hierarchy"}, "id": "id", "trait_type": "trait_type", "updated_at": "2024-01-15T09:30:00Z"}, "trait_id": "trait_id", "updated_at": "2024-01-15T09:30:00Z"}, "has_valid_allocation": true, "is_unlimited": true, "metric_reset_at": "2024-01-15T09:30:00Z", "month_reset": "month_reset", "monthly_usage_based_price": map[string]interface{}{"billing_scheme": "billing_scheme", "created_at": "2024-01-15T09:30:00Z", "currency": "currency", "id": "id", "interval": "interval", "is_active": true, "meter_event_name": "meter_event_name", "meter_event_payload_key": "meter_event_payload_key", "meter_id": "meter_id", "package_size": 1, "price": 1, "price_decimal": "price_decimal", "price_external_id": "price_external_id", "price_id": "price_id", "price_tier": []interface{}{map[string]interface{}{"flat_amount": 1, "per_unit_price": 1, "per_unit_price_decimal": "per_unit_price_decimal", "up_to": 1}, map[string]interface{}{"flat_amount": 1, "per_unit_price": 1, "per_unit_price_decimal": "per_unit_price_decimal", "up_to": 1}}, "product_external_id": "product_external_id", "product_id": "product_id", "product_name": "product_name", "tiers_mode": "tiers_mode", "updated_at": "2024-01-15T09:30:00Z", "usage_type": "usage_type"}, "overuse": 1, "percent_used": 1.1, "period": "period", "plan": map[string]interface{}{"audience_type": "audience_type", "created_at": "2024-01-15T09:30:00Z", "description": "description", "icon": "icon", "id": "id", "name": "name", "plan_type": "plan_type", "updated_at": "2024-01-15T09:30:00Z"}, "plan_entitlement": map[string]interface{}{"billing_threshold": 1, "consumption_rate": 1.1, "created_at": "2024-01-15T09:30:00Z", "environment_id": "environment_id", "feature": map[string]interface{}{"created_at": "2024-01-15T09:30:00Z", "description": "description", "event_subtype": "event_subtype", "feature_type": "feature_type", "icon": "icon", "id": "id", "lifecycle_phase": "lifecycle_phase", "maintainer_id": "maintainer_id", "name": "name", "plural_name": "plural_name", "singular_name": "singular_name", "trait_id": "trait_id", "updated_at": "2024-01-15T09:30:00Z"}, "feature_id": "feature_id", "id": "id", "metered_monthly_price": map[string]interface{}{"billing_scheme": "billing_scheme", "created_at": "2024-01-15T09:30:00Z", "currency": "currency", "id": "id", "interval": "interval", "is_active": true, "meter_event_name": "meter_event_name", "meter_event_payload_key": "meter_event_payload_key", "meter_id": "meter_id", "package_size": 1, "price": 1, "price_decimal": "price_decimal", "price_external_id": "price_external_id", "price_id": "price_id", "price_tier": []interface{}{map[string]interface{}{}, map[string]interface{}{}}, "product_external_id": "product_external_id", "product_id": "product_id", "product_name": "product_name", "tiers_mode": "tiers_mode", "updated_at": "2024-01-15T09:30:00Z", "usage_type": "usage_type"}, "metered_yearly_price": map[string]interface{}{"billing_scheme": "billing_scheme", "created_at": "2024-01-15T09:30:00Z", "currency": "currency", "id": "id", "interval": "interval", "is_active": true, "meter_event_name": "meter_event_name", "meter_event_payload_key": "meter_event_payload_key", "meter_id": "meter_id", "package_size": 1, "price": 1, "price_decimal": "price_decimal", "price_external_id": "price_external_id", "price_id": "price_id", "price_tier": []interface{}{map[string]interface{}{}, map[string]interface{}{}}, "product_external_id": "product_external_id", "product_id": "product_id", "product_name": "product_name", "tiers_mode": "tiers_mode", "updated_at": "2024-01-15T09:30:00Z", "usage_type": "usage_type"}, "metric_period": "metric_period", "metric_period_month_reset": "metric_period_month_reset", "plan": map[string]interface{}{"audience_type": "audience_type", "created_at": "2024-01-15T09:30:00Z", "description": "description", "icon": "icon", "id": "id", "name": "name", "plan_type": "plan_type", "updated_at": "2024-01-15T09:30:00Z"}, "plan_id": "plan_id", "price_behavior": "price_behavior", "rule_id": "rule_id", "rule_id_usage_exceeded": "rule_id_usage_exceeded", "soft_limit": 1, "updated_at": "2024-01-15T09:30:00Z", "usage_based_product": map[string]interface{}{"account_id": "account_id", "created_at": "2024-01-15T09:30:00Z", "currency": "currency", "environment_id": "environment_id", "external_id": "external_id", "is_active": true, "name": "name", "price": 1.1, "price_decimal": "price_decimal", "product_id": "product_id", "quantity": 1.1, "updated_at": "2024-01-15T09:30:00Z"}, "value_bool": true, "value_credit": map[string]interface{}{"burn_strategy": "burn_strategy", "created_at": "2024-01-15T09:30:00Z", "default_expiry_unit": "default_expiry_unit", "default_expiry_unit_count": 1, "default_rollover_policy": "default_rollover_policy", "description": "description", "icon": "icon", "id": "id", "name": "name", "plural_name": "plural_name", "price": map[string]interface{}{"currency": "currency", "external_price_id": "external_price_id", "id": "id", "interval": "interval", "price": 1, "scheme": "scheme"}, "product": map[string]interface{}{"account_id": "account_id", "created_at": "2024-01-15T09:30:00Z", "environment_id": "environment_id", "external_id": "external_id", "is_active": true, "name": "name", "price": 1.1, "product_id": "product_id", "quantity": 1.1, "updated_at": "2024-01-15T09:30:00Z"}, "singular_name": "singular_name", "updated_at": "2024-01-15T09:30:00Z"}, "value_numeric": 1, "value_trait": map[string]interface{}{"created_at": "2024-01-15T09:30:00Z", "display_name": "display_name", "entity_type": "entity_type", "hierarchy": []interface{}{"hierarchy", "hierarchy"}, "id": "id", "trait_type": "trait_type", "updated_at": "2024-01-15T09:30:00Z"}, "value_trait_id": "value_trait_id", "value_type": "value_type"}, "price_behavior": "price_behavior", "soft_limit": 1, "usage": 1, "yearly_usage_based_price": map[string]interface{}{"billing_scheme": "billing_scheme", "created_at": "2024-01-15T09:30:00Z", "currency": "currency", "id": "id", "interval": "interval", "is_active": true, "meter_event_name": "meter_event_name", "meter_event_payload_key": "meter_event_payload_key", "meter_id": "meter_id", "package_size": 1, "price": 1, "price_decimal": "price_decimal", "price_external_id": "price_external_id", "price_id": "price_id", "price_tier": []interface{}{map[string]interface{}{"flat_amount": 1, "per_unit_price": 1, "per_unit_price_decimal": "per_unit_price_decimal", "up_to": 1}, map[string]interface{}{"flat_amount": 1, "per_unit_price": 1, "per_unit_price_decimal": "per_unit_price_decimal", "up_to": 1}}, "product_external_id": "product_external_id", "product_id": "product_id", "product_name": "product_name", "tiers_mode": "tiers_mode", "updated_at": "2024-01-15T09:30:00Z", "usage_type": "usage_type"}}}}, "params": map[string]interface{}{"keys": map[string]interface{}{"keys": "keys"}}},
		).WithStatus(http.StatusOK),
	)
	err := WireMockClient.StubFor(stub)
	require.NoError(t, err, "Failed to create WireMock stub")

	client := client.NewSchematicClient(
		option.WithBaseURL(
			WireMockBaseURL,
		),
	)
	request := &schematichq.GetFeatureUsageByCompanyRequest{
		Keys: map[string]string{
			"keys": "keys",
		},
	}
	_, invocationErr := client.Entitlements.GetFeatureUsageByCompany(
		context.TODO(),
		request,
	)

	require.NoError(t, invocationErr, "Client method call should succeed")
	ok, countErr := WireMockClient.Verify(stub.Request(), 1)
	require.NoError(t, countErr, "Failed to verify WireMock request was matched")
	require.True(t, ok, "WireMock request was not matched")
}
